============================= test session starts ==============================
platform darwin -- Python 3.12.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/anaconda3/bin/python
cachedir: .pytest_cache
rootdir: /Users/ibrahim/Documents/Github/marketing_tool
configfile: pytest.ini
plugins: asyncio-1.2.0, anyio-4.11.0, httpx-0.35.0, langsmith-0.4.32, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 584 items

tests/api/test_analytics.py::TestAnalyticsAPI::test_get_dashboard_analytics_success PASSED [  0%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_dashboard_analytics_error PASSED [  0%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_pipeline_analytics_success PASSED [  0%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_pipeline_analytics_error PASSED [  0%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_content_analytics_success PASSED [  0%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_content_analytics_error PASSED [  1%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_recent_activity_success PASSED [  1%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_recent_activity_with_custom_days PASSED [  1%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_recent_activity_error PASSED [  1%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_trends_success PASSED [  1%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_trends_with_custom_days PASSED [  1%]
tests/api/test_analytics.py::TestAnalyticsAPI::test_get_trends_error PASSED [  2%]
tests/api/test_approvals.py::test_get_pending_approvals PASSED           [  2%]
tests/api/test_approvals.py::test_get_pending_approvals_with_job_id PASSED [  2%]
tests/api/test_approvals.py::test_delete_all_approvals PASSED            [  2%]
tests/api/test_approvals.py::test_get_approval_analytics PASSED          [  2%]
tests/api/test_approvals.py::test_get_approval_stats PASSED              [  2%]
tests/api/test_approvals.py::test_get_approval_settings PASSED           [  3%]
tests/api/test_approvals.py::test_update_approval_settings PASSED        [  3%]
tests/api/test_approvals.py::test_get_approval PASSED                    [  3%]
tests/api/test_approvals.py::test_get_approval_not_found PASSED          [  3%]
tests/api/test_approvals.py::test_decide_approval PASSED                 [  3%]
tests/api/test_approvals.py::test_decide_approval_reject FAILED          [  3%]
tests/api/test_approvals.py::test_get_all_approvals_for_job FAILED       [  4%]
tests/api/test_approvals.py::test_bulk_approve PASSED                    [  4%]
tests/api/test_approvals.py::test_get_job_approvals PASSED               [  4%]
tests/api/test_approvals.py::test_retry_rejected_step FAILED             [  4%]
tests/api/test_approvals.py::test_get_approval_impact PASSED             [  4%]
tests/api/test_content_endpoints.py::TestListContentSources::test_list_content_sources_success PASSED [  4%]
tests/api/test_content_endpoints.py::TestListContentSources::test_list_content_sources_with_error PASSED [  5%]
tests/api/test_content_endpoints.py::TestListContentSources::test_list_content_sources_manager_error PASSED [  5%]
tests/api/test_content_endpoints.py::TestGetSourceStatus::test_get_source_status_success PASSED [  5%]
tests/api/test_content_endpoints.py::TestGetSourceStatus::test_get_source_status_not_found PASSED [  5%]
tests/api/test_content_endpoints.py::TestGetSourceStatus::test_get_source_status_error PASSED [  5%]
tests/api/test_content_endpoints.py::TestFetchFromSource::test_fetch_from_source_success PASSED [  5%]
tests/api/test_content_endpoints.py::TestFetchFromSource::test_fetch_from_source_not_found PASSED [  6%]
tests/api/test_content_endpoints.py::TestFetchFromSource::test_fetch_from_source_error PASSED [  6%]
tests/api/test_core_endpoints.py::TestAnalyzeEndpoint::test_analyze_content_success PASSED [  6%]
tests/api/test_core_endpoints.py::TestAnalyzeEndpoint::test_analyze_content_analysis_error PASSED [  6%]
tests/api/test_core_endpoints.py::TestPipelineEndpoint::test_run_pipeline_success_blog ERROR [  6%]
tests/api/test_core_endpoints.py::TestPipelineEndpoint::test_run_pipeline_processor_error ERROR [  7%]
tests/api/test_core_endpoints.py::TestPipelineEndpoint::test_run_pipeline_execution_error ERROR [  7%]
tests/api/test_design_kit.py::test_get_design_kit_config PASSED          [  7%]
tests/api/test_design_kit.py::test_get_design_kit_config_not_found PASSED [  7%]
tests/api/test_design_kit.py::test_get_design_kit_config_refresh PASSED  [  7%]
tests/api/test_design_kit.py::test_update_design_kit_config PASSED       [  7%]
tests/api/test_design_kit.py::test_get_design_kit_templates FAILED       [  8%]
tests/api/test_design_kit.py::test_get_design_kit_assets FAILED          [  8%]
tests/api/test_health_endpoints.py::TestHealthCheck::test_health_check_success PASSED [  8%]
tests/api/test_health_endpoints.py::TestHealthCheck::test_health_check_config_not_loaded PASSED [  8%]
tests/api/test_health_endpoints.py::TestHealthCheck::test_health_check_prompts_dir_missing PASSED [  8%]
tests/api/test_health_endpoints.py::TestHealthCheck::test_health_check_both_fail PASSED [  8%]
tests/api/test_health_endpoints.py::TestHealthCheck::test_health_check_exception PASSED [  9%]
tests/api/test_health_endpoints.py::TestReadinessCheck::test_readiness_check_success PASSED [  9%]
tests/api/test_health_endpoints.py::TestReadinessCheck::test_readiness_check_config_not_loaded PASSED [  9%]
tests/api/test_health_endpoints.py::TestReadinessCheck::test_readiness_check_prompts_dir_missing PASSED [  9%]
tests/api/test_health_endpoints.py::TestReadinessCheck::test_readiness_check_exception PASSED [  9%]
tests/api/test_health_endpoints.py::TestNoAuthentication::test_health_check_no_auth_required PASSED [  9%]
tests/api/test_health_endpoints.py::TestNoAuthentication::test_readiness_check_no_auth_required PASSED [ 10%]
tests/api/test_internal_docs.py::test_get_internal_docs_config PASSED    [ 10%]
tests/api/test_internal_docs.py::test_get_internal_docs_config_not_found FAILED [ 10%]
tests/api/test_internal_docs.py::test_scan_internal_docs FAILED          [ 10%]
tests/api/test_internal_docs.py::test_update_internal_docs_config PASSED [ 10%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_list_jobs_success PASSED [ 10%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_list_jobs_with_filters PASSED [ 11%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_list_jobs_error PASSED [ 11%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_success PASSED [ 11%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_not_found PASSED [ 11%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_status_success PASSED [ 11%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_status_not_found PASSED [ 11%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_result_success PASSED [ 12%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_result_pending PASSED [ 12%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_result_failed PASSED [ 12%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_cancel_job_success PASSED [ 12%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_cancel_job_not_found PASSED [ 12%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_cancel_job_already_completed PASSED [ 13%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_chain_success PASSED [ 13%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_get_job_chain_not_found PASSED [ 13%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_delete_all_jobs_success PASSED [ 13%]
tests/api/test_jobs_endpoints.py::TestJobsAPI::test_clear_arq_jobs_success PASSED [ 13%]
tests/api/test_processor_endpoints.py::TestBlogProcessorEndpoint::test_process_blog_submits_job PASSED [ 13%]
tests/api/test_processor_endpoints.py::TestBlogProcessorEndpoint::test_process_blog_with_output_content_type PASSED [ 14%]
tests/api/test_processor_endpoints.py::TestBlogProcessorEndpoint::test_process_blog_job_creation_failure PASSED [ 14%]
tests/api/test_processor_endpoints.py::TestReleaseNotesProcessorEndpoint::test_process_release_notes_submits_job PASSED [ 14%]
tests/api/test_processor_endpoints.py::TestTranscriptProcessorEndpoint::test_process_transcript_submits_job PASSED [ 14%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_list_jobs_success PASSED [ 14%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_list_jobs_with_limit PASSED [ 14%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_list_jobs_error PASSED [ 15%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_get_job_results_success PASSED [ 15%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_get_job_results_with_filters PASSED [ 15%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_get_job_results_not_found PASSED [ 15%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_get_step_result_success PASSED [ 15%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_get_step_result_not_found PASSED [ 15%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_download_step_result_success PASSED [ 16%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_download_step_result_not_found PASSED [ 16%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_delete_job_results_success PASSED [ 16%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_delete_job_results_not_found PASSED [ 16%]
tests/api/test_step_results_endpoints.py::TestStepResultsAPI::test_get_job_timeline_success PASSED [ 16%]
tests/api/test_system_endpoints.py::TestSystemInfo::test_get_system_info_success PASSED [ 16%]
tests/api/test_system_endpoints.py::TestSystemInfo::test_get_system_info_with_missing_config PASSED [ 17%]
tests/api/test_system_endpoints.py::TestSystemInfo::test_get_system_info_error PASSED [ 17%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_json_file_success PASSED [ 17%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_text_file_success PASSED [ 17%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_unsupported_file_type PASSED [ 17%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_file_too_large PASSED [ 17%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_from_url_success PASSED [ 18%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_from_url_insufficient_content PASSED [ 18%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_upload_from_url_fetch_error PASSED [ 18%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_get_upload_status PASSED [ 18%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_extract_text_from_docx PASSED [ 18%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_extract_text_from_pdf PASSED [ 19%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_extract_text_from_csv PASSED [ 19%]
tests/api/test_upload_endpoints.py::TestUploadAPI::test_extract_text_from_rtf PASSED [ 19%]
tests/core/test_utils.py::TestConvertDictToContentContext::test_convert_blog_post_dict PASSED [ 19%]
tests/core/test_utils.py::TestConvertDictToContentContext::test_convert_transcript_dict PASSED [ 19%]
tests/core/test_utils.py::TestConvertDictToContentContext::test_convert_release_notes_dict PASSED [ 19%]
tests/core/test_utils.py::TestConvertDictToContentContext::test_convert_invalid_dict PASSED [ 20%]
tests/core/test_utils.py::TestEnsureContentContext::test_ensure_content_context_with_dict PASSED [ 20%]
tests/core/test_utils.py::TestEnsureContentContext::test_ensure_content_context_with_object PASSED [ 20%]
tests/core/test_utils.py::TestValidateContentForProcessing::test_validate_valid_blog_post PASSED [ 20%]
tests/core/test_utils.py::TestValidateContentForProcessing::test_validate_invalid_blog_post_missing_title PASSED [ 20%]
tests/core/test_utils.py::TestValidateContentForProcessing::test_validate_valid_transcript PASSED [ 20%]
tests/core/test_utils.py::TestValidateContentForProcessing::test_validate_valid_release_notes PASSED [ 21%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_connection_pooling PASSED [ 21%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_basic_operations PASSED [ 21%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_pipeline_operations PASSED [ 21%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_retry_on_failure PASSED [ 21%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_health_check PASSED [ 21%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_circuit_breaker_recovery PASSED [ 22%]
tests/integration/test_redis_integration.py::TestRedisIntegration::test_connection_cleanup PASSED [ 22%]
tests/integration/test_redis_integration.py::TestRedisFailover::test_failover_handling PASSED [ 22%]
tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_linkedin_pipeline_execution FAILED [ 22%]
tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_hackernews_pipeline_execution FAILED [ 22%]
tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_email_pipeline_execution_newsletter FAILED [ 22%]
tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_email_pipeline_execution_promotional PASSED [ 23%]
tests/integration/test_social_media_pipeline_integration.py::TestMultiPlatformGeneration::test_multi_platform_parallel_execution PASSED [ 23%]
tests/integration/test_social_media_pipeline_integration.py::TestErrorScenarios::test_invalid_json_input PASSED [ 23%]
tests/integration/test_social_media_pipeline_integration.py::TestErrorScenarios::test_missing_required_fields PASSED [ 23%]
tests/integration/test_social_media_pipeline_integration.py::TestErrorScenarios::test_invalid_platform PASSED [ 23%]
tests/integration/test_social_media_pipeline_integration.py::TestPerformanceBenchmarks::test_pipeline_execution_time PASSED [ 23%]
tests/integration/test_social_media_pipeline_integration.py::TestPerformanceBenchmarks::test_token_usage_tracking PASSED [ 24%]
tests/integration/test_social_media_pipeline_integration.py::TestContentValidation::test_content_length_validation FAILED [ 24%]
tests/integration/test_social_media_pipeline_integration.py::TestPlatformSpecificFeatures::test_linkedin_hashtags FAILED [ 24%]
tests/integration/test_social_media_pipeline_integration.py::TestPlatformSpecificFeatures::test_email_subject_line FAILED [ 24%]
tests/integrations/test_function_pipeline_e2e.py::TestFunctionPipelineE2E::test_complete_pipeline_flow PASSED [ 24%]
tests/integrations/test_function_pipeline_e2e.py::TestFunctionPipelineE2E::test_pipeline_with_job_tracking PASSED [ 25%]
tests/integrations/test_function_pipeline_e2e.py::TestFunctionPipelineE2E::test_pipeline_error_handling PASSED [ 25%]
tests/middleware/test_cors.py::test_setup_cors_default_origins PASSED    [ 25%]
tests/middleware/test_cors.py::test_setup_cors_custom_origins PASSED     [ 25%]
tests/middleware/test_cors.py::test_setup_cors_with_credentials PASSED   [ 25%]
tests/middleware/test_cors.py::test_cors_preflight_request PASSED        [ 25%]
tests/middleware/test_cors.py::test_cors_actual_request PASSED           [ 26%]
tests/middleware/test_error_handling.py::test_error_handling_middleware_initialization PASSED [ 26%]
tests/middleware/test_error_handling.py::test_error_handling_middleware_with_debug PASSED [ 26%]
tests/middleware/test_error_handling.py::test_http_exception_handling PASSED [ 26%]
tests/middleware/test_error_handling.py::test_generic_exception_handling PASSED [ 26%]
tests/middleware/test_error_handling.py::test_validation_error_handling PASSED [ 26%]
tests/middleware/test_logging.py::test_logging_middleware_initialization PASSED [ 27%]
tests/middleware/test_logging.py::test_logging_middleware_with_options PASSED [ 27%]
tests/middleware/test_logging.py::test_logging_middleware_request_logging PASSED [ 27%]
tests/middleware/test_logging.py::test_request_id_middleware_initialization PASSED [ 27%]
tests/middleware/test_logging.py::test_request_id_middleware_custom_header PASSED [ 27%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_allowed_host PASSED [ 27%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_rejected_host PASSED [ 28%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_health_check_bypass PASSED [ 28%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_ready_check_bypass PASSED [ 28%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_wildcard_subdomain PASSED [ 28%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_no_allowed_hosts FAILED [ 28%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_host_with_port PASSED [ 28%]
tests/middleware/test_trusted_host.py::test_trusted_host_middleware_missing_host_header FAILED [ 29%]
tests/plugins/test_article_generation_plugin.py::TestArticleGenerationPlugin::test_step_name PASSED [ 29%]
tests/plugins/test_article_generation_plugin.py::TestArticleGenerationPlugin::test_step_number FAILED [ 29%]
tests/plugins/test_article_generation_plugin.py::TestArticleGenerationPlugin::test_response_model PASSED [ 29%]
tests/plugins/test_article_generation_plugin.py::TestArticleGenerationPlugin::test_execute PASSED [ 29%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentType::test_analyze_transcript_content PASSED [ 29%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentType::test_analyze_blog_post_content PASSED [ 30%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentType::test_analyze_release_notes_content PASSED [ 30%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentType::test_analyze_email_content PASSED [ 30%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentType::test_analyze_generic_content FAILED [ 30%]
tests/plugins/test_content_analysis.py::TestExtractContentMetadata::test_extract_transcript_metadata PASSED [ 30%]
tests/plugins/test_content_analysis.py::TestExtractContentMetadata::test_extract_blog_post_metadata PASSED [ 30%]
tests/plugins/test_content_analysis.py::TestExtractContentMetadata::test_extract_release_notes_metadata PASSED [ 31%]
tests/plugins/test_content_analysis.py::TestValidateContentStructure::test_validate_valid_content PASSED [ 31%]
tests/plugins/test_content_analysis.py::TestValidateContentStructure::test_validate_content_missing_id PASSED [ 31%]
tests/plugins/test_content_analysis.py::TestValidateContentStructure::test_validate_content_missing_title PASSED [ 31%]
tests/plugins/test_content_analysis.py::TestValidateContentStructure::test_validate_content_missing_content PASSED [ 31%]
tests/plugins/test_content_analysis.py::TestValidateContentStructure::test_validate_content_missing_snippet PASSED [ 32%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentForPipeline::test_analyze_valid_content FAILED [ 32%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentForPipeline::test_analyze_invalid_content PASSED [ 32%]
tests/plugins/test_content_analysis.py::TestAnalyzeContentForPipeline::test_analyze_content_error_handling PASSED [ 32%]
tests/plugins/test_content_analysis.py::TestCalculateBasicReadability::test_calculate_readability_good_text PASSED [ 32%]
tests/plugins/test_content_analysis.py::TestCalculateBasicReadability::test_calculate_readability_poor_text PASSED [ 32%]
tests/plugins/test_content_analysis.py::TestCalculateBasicReadability::test_calculate_readability_empty_text PASSED [ 33%]
tests/plugins/test_content_analysis.py::TestCalculateBasicReadability::test_calculate_readability_no_sentences PASSED [ 33%]
tests/plugins/test_content_analysis.py::TestAssessContentCompleteness::test_assess_complete_content PASSED [ 33%]
tests/plugins/test_content_analysis.py::TestAssessContentCompleteness::test_assess_incomplete_content PASSED [ 33%]
tests/plugins/test_content_analysis.py::TestExtractPotentialKeywords::test_extract_keywords_from_text PASSED [ 33%]
tests/plugins/test_content_analysis.py::TestExtractPotentialKeywords::test_extract_keywords_empty_text PASSED [ 33%]
tests/plugins/test_content_analysis.py::TestExtractPotentialKeywords::test_extract_keywords_filters_stop_words PASSED [ 34%]
tests/plugins/test_content_analysis.py::TestAssessTitleSEO::test_assess_good_title PASSED [ 34%]
tests/plugins/test_content_analysis.py::TestAssessTitleSEO::test_assess_poor_title PASSED [ 34%]
tests/plugins/test_content_analysis.py::TestAssessTitleSEO::test_assess_no_title PASSED [ 34%]
tests/plugins/test_content_analysis.py::TestAssessContentStructure::test_assess_well_structured_content PASSED [ 34%]
tests/plugins/test_content_analysis.py::TestAssessContentStructure::test_assess_poorly_structured_content PASSED [ 34%]
tests/plugins/test_content_analysis.py::TestAssessLinkingPotential::test_assess_content_with_linking_opportunities PASSED [ 35%]
tests/plugins/test_content_analysis.py::TestAssessLinkingPotential::test_assess_content_without_linking_opportunities PASSED [ 35%]
tests/plugins/test_content_analysis.py::TestAssessEngagementPotential::test_assess_engaging_content PASSED [ 35%]
tests/plugins/test_content_analysis.py::TestAssessEngagementPotential::test_assess_non_engaging_content PASSED [ 35%]
tests/plugins/test_content_analysis.py::TestAssessConversionPotential::test_assess_high_conversion_content PASSED [ 35%]
tests/plugins/test_content_analysis.py::TestAssessConversionPotential::test_assess_low_conversion_content PASSED [ 35%]
tests/plugins/test_content_analysis.py::TestAssessShareability::test_assess_shareable_content PASSED [ 36%]
tests/plugins/test_content_analysis.py::TestAssessShareability::test_assess_non_shareable_content PASSED [ 36%]
tests/plugins/test_content_analysis.py::TestAssessAudienceAppeal::test_assess_beginner_content PASSED [ 36%]
tests/plugins/test_content_analysis.py::TestAssessAudienceAppeal::test_assess_expert_content PASSED [ 36%]
tests/plugins/test_content_analysis.py::TestAssessAudienceAppeal::test_assess_practical_content PASSED [ 36%]
tests/plugins/test_content_analysis.py::TestEstimateSyllables::test_estimate_syllables_simple_words PASSED [ 36%]
tests/plugins/test_content_analysis.py::TestEstimateSyllables::test_estimate_syllables_complex_words PASSED [ 37%]
tests/plugins/test_content_analysis.py::TestEstimateSyllables::test_estimate_syllables_empty_word PASSED [ 37%]
tests/plugins/test_content_analysis.py::TestEstimateSyllables::test_estimate_syllables_with_punctuation PASSED [ 37%]
tests/plugins/test_content_analysis.py::TestIntegration::test_full_content_analysis_workflow FAILED [ 37%]
tests/plugins/test_content_formatting_plugin.py::TestContentFormattingPlugin::test_step_name PASSED [ 37%]
tests/plugins/test_content_formatting_plugin.py::TestContentFormattingPlugin::test_step_number FAILED [ 38%]
tests/plugins/test_content_formatting_plugin.py::TestContentFormattingPlugin::test_response_model PASSED [ 38%]
tests/plugins/test_content_formatting_plugin.py::TestContentFormattingPlugin::test_execute PASSED [ 38%]
tests/plugins/test_marketing_brief_plugin.py::TestMarketingBriefPlugin::test_step_name PASSED [ 38%]
tests/plugins/test_marketing_brief_plugin.py::TestMarketingBriefPlugin::test_step_number FAILED [ 38%]
tests/plugins/test_marketing_brief_plugin.py::TestMarketingBriefPlugin::test_response_model PASSED [ 38%]
tests/plugins/test_marketing_brief_plugin.py::TestMarketingBriefPlugin::test_get_required_context_keys PASSED [ 39%]
tests/plugins/test_marketing_brief_plugin.py::TestMarketingBriefPlugin::test_execute PASSED [ 39%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_init PASSED [ 39%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_register_plugin PASSED [ 39%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_register_plugin_overwrite PASSED [ 39%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_register_invalid_plugin PASSED [ 39%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_get_plugin PASSED [ 40%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_get_plugin_not_found PASSED [ 40%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_get_plugin_by_number PASSED [ 40%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_get_plugins_in_order PASSED [ 40%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_auto_discover PASSED [ 40%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_validate_dependencies PASSED [ 40%]
tests/plugins/test_plugin_registry.py::TestPluginRegistry::test_validate_dependencies_missing PASSED [ 41%]
tests/plugins/test_plugin_registry.py::TestGetPluginRegistry::test_get_plugin_registry_returns_singleton PASSED [ 41%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_step_name PASSED [ 41%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_step_number FAILED [ 41%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_response_model PASSED [ 41%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_get_required_context_keys PASSED [ 41%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_validate_context PASSED [ 42%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_validate_context_missing_key PASSED [ 42%]
tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_execute FAILED [ 42%]
tests/plugins/test_seo_optimization_plugin.py::TestSEOOptimizationPlugin::test_step_name PASSED [ 42%]
tests/plugins/test_seo_optimization_plugin.py::TestSEOOptimizationPlugin::test_step_number FAILED [ 42%]
tests/plugins/test_seo_optimization_plugin.py::TestSEOOptimizationPlugin::test_response_model PASSED [ 42%]
tests/plugins/test_seo_optimization_plugin.py::TestSEOOptimizationPlugin::test_execute PASSED [ 43%]
tests/plugins/test_suggested_links_plugin.py::TestSuggestedLinksPlugin::test_step_name PASSED [ 43%]
tests/plugins/test_suggested_links_plugin.py::TestSuggestedLinksPlugin::test_step_number FAILED [ 43%]
tests/plugins/test_suggested_links_plugin.py::TestSuggestedLinksPlugin::test_response_model PASSED [ 43%]
tests/plugins/test_suggested_links_plugin.py::TestSuggestedLinksPlugin::test_execute PASSED [ 43%]
tests/processors/test_approval_helper.py::test_approval_required_exception PASSED [ 44%]
tests/processors/test_approval_helper.py::test_check_and_create_approval_request_approvals_disabled PASSED [ 44%]
tests/processors/test_approval_helper.py::test_check_and_create_approval_request_agent_not_in_list PASSED [ 44%]
tests/processors/test_approval_helper.py::test_check_and_create_approval_request_approval_required FAILED [ 44%]
tests/processors/test_approval_helper.py::test_extract_confidence_score_with_confidence PASSED [ 44%]
tests/processors/test_approval_helper.py::test_extract_confidence_score_with_confidence_score PASSED [ 44%]
tests/processors/test_approval_helper.py::test_extract_confidence_score_without_confidence PASSED [ 45%]
tests/processors/test_approval_helper.py::test_extract_confidence_score_nested PASSED [ 45%]
tests/processors/test_approval_helper.py::test_prepare_approval_data FAILED [ 45%]
tests/processors/test_approval_helper.py::test_prepare_approval_data_with_confidence FAILED [ 45%]
tests/processors/test_approval_helper.py::test_prepare_approval_data_with_suggestions FAILED [ 45%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_success PASSED [ 45%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_invalid_json PASSED [ 46%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_invalid_input FAILED [ 46%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_with_output_content_type PASSED [ 46%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_pipeline_failure PASSED [ 46%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_approval_rejected PASSED [ 46%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_generates_job_id PASSED [ 46%]
tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_with_dict_input PASSED [ 47%]
tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_success PASSED [ 47%]
tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_invalid_json PASSED [ 47%]
tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_invalid_input FAILED [ 47%]
tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_with_output_content_type PASSED [ 47%]
tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_pipeline_failure PASSED [ 47%]
tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_approval_rejected PASSED [ 48%]
tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_success PASSED [ 48%]
tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_invalid_json PASSED [ 48%]
tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_invalid_input FAILED [ 48%]
tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_with_output_content_type PASSED [ 48%]
tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_pipeline_failure PASSED [ 48%]
tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_approval_rejected PASSED [ 49%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_get_dashboard_stats_success PASSED [ 49%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_get_dashboard_stats_cached PASSED [ 49%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_get_pipeline_stats_success PASSED [ 49%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_get_content_stats_success PASSED [ 49%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_get_recent_activity_success PASSED [ 50%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_get_trends_success PASSED [ 50%]
tests/services/test_analytics_service.py::TestAnalyticsService::test_cache_operations PASSED [ 50%]
tests/services/test_approval_manager.py::test_approval_manager_initialization PASSED [ 50%]
tests/services/test_approval_manager.py::test_get_redis PASSED           [ 50%]
tests/services/test_approval_manager.py::test_get_redis_error PASSED     [ 50%]
tests/services/test_approval_manager.py::test_load_settings_from_db PASSED [ 51%]
tests/services/test_approval_manager.py::test_load_settings_from_redis PASSED [ 51%]
tests/services/test_approval_manager.py::test_load_settings PASSED       [ 51%]
tests/services/test_approval_manager.py::test_load_settings_fallback_to_redis PASSED [ 51%]
tests/services/test_approval_manager.py::test_create_approval_request PASSED [ 51%]
tests/services/test_approval_manager.py::test_get_approval PASSED        [ 51%]
tests/services/test_approval_manager.py::test_get_approval_not_found PASSED [ 52%]
tests/services/test_approval_manager.py::test_list_approvals PASSED      [ 52%]
tests/services/test_approval_manager.py::test_list_approvals_with_job_id PASSED [ 52%]
tests/services/test_approval_manager.py::test_list_approvals_with_status PASSED [ 52%]
tests/services/test_approval_manager.py::test_decide_approval_approve PASSED [ 52%]
tests/services/test_approval_manager.py::test_decide_approval_reject PASSED [ 52%]
tests/services/test_approval_manager.py::test_delete_approval PASSED     [ 53%]
tests/services/test_approval_manager.py::test_delete_all_approvals PASSED [ 53%]
tests/services/test_approval_manager.py::test_save_settings_to_redis PASSED [ 53%]
tests/services/test_approval_manager.py::test_get_stats PASSED           [ 53%]
tests/services/test_approval_manager.py::test_approval_manager_settings_property PASSED [ 53%]
tests/services/test_content_source_factory.py::TestContentSourceFactory::test_create_file_source PASSED [ 53%]
tests/services/test_content_source_factory.py::TestContentSourceFactory::test_create_api_source PASSED [ 54%]
tests/services/test_content_source_factory.py::TestContentSourceFactory::test_create_uploaded_file_source PASSED [ 54%]
tests/services/test_content_source_factory.py::TestContentSourceManager::test_add_source PASSED [ 54%]
tests/services/test_content_source_factory.py::TestContentSourceManager::test_fetch_content_as_models PASSED [ 54%]
tests/services/test_content_source_factory.py::TestContentSourceManager::test_search_content_models PASSED [ 54%]
tests/services/test_content_source_factory.py::TestContentSourceManager::test_get_content_models_by_type PASSED [ 54%]
tests/services/test_content_source_factory.py::TestContentSourceManager::test_health_check_all PASSED [ 55%]
tests/services/test_content_source_factory.py::TestContentSourceManager::test_get_source_statistics PASSED [ 55%]
tests/services/test_content_source_factory.py::TestContentSourceConfigLoader::test_load_from_environment PASSED [ 55%]
tests/services/test_content_source_factory.py::TestContentSourceConfigLoader::test_substitute_env_vars PASSED [ 55%]
tests/services/test_content_source_factory.py::TestContentSourceConfigLoader::test_create_source_configs PASSED [ 55%]
tests/services/test_content_source_factory.py::TestContentSourceIntegration::test_pipeline_integration PASSED [ 55%]
tests/services/test_content_source_factory.py::test_content_source_error_handling PASSED [ 56%]
tests/services/test_content_sources.py::test_api_content_source_initialization PASSED [ 56%]
tests/services/test_content_sources.py::test_api_content_source_get_status PASSED [ 56%]
tests/services/test_content_sources.py::test_api_content_source_fetch_content PASSED [ 56%]
tests/services/test_content_sources.py::test_api_content_source_health_check PASSED [ 56%]
tests/services/test_content_sources.py::test_database_content_source_initialization PASSED [ 57%]
tests/services/test_content_sources.py::test_database_content_source_get_status PASSED [ 57%]
tests/services/test_content_sources.py::test_database_content_source_fetch_content PASSED [ 57%]
tests/services/test_content_sources.py::test_database_content_source_health_check PASSED [ 57%]
tests/services/test_content_sources.py::test_web_scraping_content_source_initialization FAILED [ 57%]
tests/services/test_content_sources.py::test_web_scraping_content_source_get_status PASSED [ 57%]
tests/services/test_content_sources.py::test_web_scraping_content_source_fetch_content FAILED [ 58%]
tests/services/test_content_sources.py::test_web_scraping_content_source_health_check PASSED [ 58%]
tests/services/test_content_sources.py::test_api_content_source_error_handling PASSED [ 58%]
tests/services/test_content_sources.py::test_database_content_source_error_handling PASSED [ 58%]
tests/services/test_database.py::test_database_manager_initialization PASSED [ 58%]
tests/services/test_database.py::test_get_database_url_from_database_url_env PASSED [ 58%]
tests/services/test_database.py::test_get_database_url_from_postgres_url_env PASSED [ 59%]
tests/services/test_database.py::test_get_database_url_postgres_to_postgresql_asyncpg PASSED [ 59%]
tests/services/test_database.py::test_get_database_url_postgresql_to_asyncpg PASSED [ 59%]
tests/services/test_database.py::test_get_database_url_no_scheme PASSED  [ 59%]
tests/services/test_database.py::test_get_database_url_no_env_vars PASSED [ 59%]
tests/services/test_database.py::test_initialize_no_database_url PASSED  [ 59%]
tests/services/test_database.py::test_initialize_already_initialized PASSED [ 60%]
tests/services/test_database.py::test_initialize_success PASSED          [ 60%]
tests/services/test_database.py::test_initialize_failure PASSED          [ 60%]
tests/services/test_database.py::test_create_tables_not_initialized PASSED [ 60%]
tests/services/test_database.py::test_create_tables_success PASSED       [ 60%]
tests/services/test_database.py::test_get_session_not_initialized PASSED [ 60%]
tests/services/test_database.py::test_get_session_success PASSED         [ 61%]
tests/services/test_database.py::test_get_session_rollback_on_error PASSED [ 61%]
tests/services/test_database.py::test_health_check_not_initialized PASSED [ 61%]
tests/services/test_database.py::test_health_check_success PASSED        [ 61%]
tests/services/test_database.py::test_health_check_failure PASSED        [ 61%]
tests/services/test_database.py::test_cleanup PASSED                     [ 61%]
tests/services/test_database.py::test_is_initialized_property PASSED     [ 62%]
tests/services/test_database.py::test_engine_property PASSED             [ 62%]
tests/services/test_database.py::test_get_database_manager_singleton PASSED [ 62%]
tests/services/test_engines_framework.py::TestEngineRegistry::test_register_and_get PASSED [ 62%]
tests/services/test_engines_framework.py::TestEngineRegistry::test_get_nonexistent PASSED [ 62%]
tests/services/test_engines_framework.py::TestEngineRegistry::test_list_types PASSED [ 63%]
tests/services/test_engines_framework.py::TestEngineRegistry::test_global_registry PASSED [ 63%]
tests/services/test_engines_framework.py::TestEngineComposer::test_default_engine PASSED [ 63%]
tests/services/test_engines_framework.py::TestEngineComposer::test_field_override PASSED [ 63%]
tests/services/test_engines_framework.py::TestEngineComposer::test_get_engine_type_for_field PASSED [ 63%]
tests/services/test_engines_framework.py::TestEngineComposer::test_missing_engine PASSED [ 63%]
tests/services/test_function_pipeline.py::TestFunctionPipelineInitialization::test_init_defaults PASSED [ 64%]
tests/services/test_function_pipeline.py::TestFunctionPipelineInitialization::test_init_custom_params PASSED [ 64%]
tests/services/test_function_pipeline.py::TestFunctionPipelineExecution::test_execute_pipeline_success PASSED [ 64%]
tests/services/test_function_pipeline.py::TestFunctionPipelineExecution::test_execute_pipeline_invalid_json PASSED [ 64%]
tests/services/test_function_pipeline.py::TestFunctionPipelineExecution::test_execute_pipeline_dependency_validation_failure PASSED [ 64%]
tests/services/test_function_pipeline.py::TestFunctionPipelineExecution::test_execute_pipeline_with_output_content_type PASSED [ 64%]
tests/services/test_function_pipeline.py::TestFunctionPipelineExecution::test_execute_pipeline_plugin_not_found PASSED [ 65%]
tests/services/test_function_pipeline.py::TestFunctionPipelineExecution::test_execute_pipeline_context_validation_failure PASSED [ 65%]
tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_execute_step_with_plugin PASSED [ 65%]
tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_execute_step_plugin_not_found PASSED [ 65%]
tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_call_function PASSED [ 65%]
tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_resume_pipeline FAILED [ 65%]
tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_execute_single_step FAILED [ 66%]
tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_get_user_prompt PASSED [ 66%]
tests/services/test_internal_docs_scanner.py::test_scanner_initialization PASSED [ 66%]
tests/services/test_internal_docs_scanner.py::test_initialize PASSED     [ 66%]
tests/services/test_internal_docs_scanner.py::test_cleanup PASSED        [ 66%]
tests/services/test_internal_docs_scanner.py::test_scan_from_base_url FAILED [ 66%]
tests/services/test_internal_docs_scanner.py::test_scan_from_url_list FAILED [ 67%]
tests/services/test_internal_docs_scanner.py::test_scan_from_url_list_error_handling PASSED [ 67%]
tests/services/test_internal_docs_scanner.py::test_extract_document_info FAILED [ 67%]
tests/services/test_internal_docs_scanner.py::test_extract_links FAILED  [ 67%]
tests/services/test_internal_docs_scanner.py::test_is_valid_document_url PASSED [ 67%]
tests/services/test_internal_docs_scanner.py::test_normalize_url PASSED  [ 67%]
tests/services/test_internal_docs_scanner.py::test_get_internal_docs_scanner_singleton FAILED [ 68%]
tests/services/test_job_manager.py::TestJobManager::test_create_job PASSED [ 68%]
tests/services/test_job_manager.py::TestJobManager::test_create_job_with_custom_id PASSED [ 68%]
tests/services/test_job_manager.py::TestJobManager::test_get_job PASSED  [ 68%]
tests/services/test_job_manager.py::TestJobManager::test_get_job_not_found PASSED [ 68%]
tests/services/test_job_manager.py::TestJobManager::test_update_job_status PASSED [ 69%]
tests/services/test_job_manager.py::TestJobManager::test_update_job_progress PASSED [ 69%]
tests/services/test_job_manager.py::TestJobManager::test_submit_to_arq PASSED [ 69%]
tests/services/test_job_manager.py::TestJobManager::test_list_jobs PASSED [ 69%]
tests/services/test_job_manager.py::TestGetJobManager::test_get_job_manager_returns_singleton PASSED [ 69%]
tests/services/test_redis_manager.py::TestRedisManagerInitialization::test_init PASSED [ 69%]
tests/services/test_redis_manager.py::TestRedisManagerInitialization::test_init_with_env_vars PASSED [ 70%]
tests/services/test_redis_manager.py::TestConnectionPooling::test_get_pool_creates_pool PASSED [ 70%]
tests/services/test_redis_manager.py::TestConnectionPooling::test_get_pool_reuses_pool PASSED [ 70%]
tests/services/test_redis_manager.py::TestConnectionPooling::test_get_redis_creates_client PASSED [ 70%]
tests/services/test_redis_manager.py::TestCircuitBreaker::test_circuit_breaker_closed_allows_operation PASSED [ 70%]
tests/services/test_redis_manager.py::TestCircuitBreaker::test_circuit_breaker_open_blocks_operation FAILED [ 70%]
tests/services/test_redis_manager.py::TestCircuitBreaker::test_circuit_breaker_recovery_timeout FAILED [ 71%]
tests/services/test_redis_manager.py::TestCircuitBreaker::test_record_circuit_breaker_success_closes_half_open PASSED [ 71%]
tests/services/test_redis_manager.py::TestCircuitBreaker::test_record_circuit_breaker_failure_opens_circuit PASSED [ 71%]
tests/services/test_redis_manager.py::TestRetryLogic::test_execute_success PASSED [ 71%]
tests/services/test_redis_manager.py::TestRetryLogic::test_execute_retries_on_connection_error PASSED [ 71%]
tests/services/test_redis_manager.py::TestRetryLogic::test_execute_circuit_breaker_blocks_when_open FAILED [ 71%]
tests/services/test_redis_manager.py::TestHealthMonitoring::test_health_check_success PASSED [ 72%]
tests/services/test_redis_manager.py::TestHealthMonitoring::test_health_check_failure PASSED [ 72%]
tests/services/test_redis_manager.py::TestHealthMonitoring::test_get_health_status PASSED [ 72%]
tests/services/test_redis_manager.py::TestCleanup::test_cleanup_closes_connections PASSED [ 72%]
tests/services/test_redis_manager.py::TestGetRedisManager::test_get_redis_manager_returns_singleton PASSED [ 72%]
tests/services/test_redis_manager.py::TestCloudWatchMetrics::test_publish_metrics_when_enabled PASSED [ 72%]
tests/services/test_redis_manager.py::TestCloudWatchMetrics::test_publish_metrics_when_disabled PASSED [ 73%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_linkedin_character_limit FAILED [ 73%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_hackernews_character_limit FAILED [ 73%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_email_character_limit_newsletter FAILED [ 73%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_email_character_limit_promotional FAILED [ 73%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformConfig::test_load_platform_config PASSED [ 73%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformConfig::test_get_platform_config_linkedin PASSED [ 74%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformConfig::test_get_platform_config_hackernews PASSED [ 74%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformConfig::test_get_platform_config_email PASSED [ 74%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformConfig::test_get_platform_config_invalid PASSED [ 74%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformSpecificTemplates::test_get_system_instruction_platform_specific PASSED [ 74%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformSpecificTemplates::test_get_system_instruction_fallback PASSED [ 75%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformQualityAssessment::test_assess_platform_quality_linkedin PASSED [ 75%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformQualityAssessment::test_assess_platform_quality_hackernews PASSED [ 75%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformQualityAssessment::test_assess_platform_quality_email PASSED [ 75%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformContentAppropriateness::test_linkedin_professional_tone PASSED [ 75%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformContentAppropriateness::test_hackernews_technical_depth PASSED [ 75%]
tests/services/test_social_media_pipeline_platforms.py::TestPlatformContentAppropriateness::test_email_formatting PASSED [ 76%]
tests/services/test_step_result_manager.py::test_step_result_manager_initialization PASSED [ 76%]
tests/services/test_step_result_manager.py::test_step_result_manager_default_dir PASSED [ 76%]
tests/services/test_step_result_manager.py::test_step_result_manager_from_env PASSED [ 76%]
tests/services/test_step_result_manager.py::test_get_job_dir PASSED      [ 76%]
tests/services/test_step_result_manager.py::test_get_step_filename PASSED [ 76%]
tests/services/test_step_result_manager.py::test_save_step_result PASSED [ 77%]
tests/services/test_step_result_manager.py::test_save_step_result_with_execution_context PASSED [ 77%]
tests/services/test_step_result_manager.py::test_get_step_result FAILED  [ 77%]
tests/services/test_step_result_manager.py::test_get_step_result_not_found PASSED [ 77%]
tests/services/test_step_result_manager.py::test_get_all_step_results FAILED [ 77%]
tests/services/test_step_result_manager.py::test_get_all_step_results_empty PASSED [ 77%]
tests/services/test_step_result_manager.py::test_save_job_metadata FAILED [ 78%]
tests/services/test_step_result_manager.py::test_get_job_metadata FAILED [ 78%]
tests/services/test_step_result_manager.py::test_get_job_metadata_not_found PASSED [ 78%]
tests/services/test_step_result_manager.py::test_delete_job_results PASSED [ 78%]
tests/services/test_step_result_manager.py::test_delete_job_results_not_found PASSED [ 78%]
tests/services/test_step_result_manager.py::test_list_jobs PASSED        [ 78%]
tests/services/test_step_result_manager.py::test_cleanup_old_results PASSED [ 79%]
tests/services/test_step_result_manager.py::test_json_serializer PASSED  [ 79%]
tests/services/test_step_result_manager.py::test_get_step_result_manager_singleton PASSED [ 79%]
tests/services/test_step_retry_service.py::test_step_retry_service_initialization PASSED [ 79%]
tests/services/test_step_retry_service.py::test_retry_step_invalid_step_name PASSED [ 79%]
tests/services/test_step_retry_service.py::test_retry_step_seo_keywords_success PASSED [ 79%]
tests/services/test_step_retry_service.py::test_retry_step_marketing_brief_success PASSED [ 80%]
tests/services/test_step_retry_service.py::test_retry_step_article_generation_success FAILED [ 80%]
tests/services/test_step_retry_service.py::test_retry_step_seo_optimization_success FAILED [ 80%]
tests/services/test_step_retry_service.py::test_retry_step_suggested_links_success PASSED [ 80%]
tests/services/test_step_retry_service.py::test_retry_step_content_formatting_success PASSED [ 80%]
tests/services/test_step_retry_service.py::test_retry_step_design_kit_success PASSED [ 80%]
tests/services/test_step_retry_service.py::test_retry_step_error_handling PASSED [ 81%]
tests/services/test_step_retry_service.py::test_retry_step_with_user_guidance PASSED [ 81%]
tests/services/test_step_retry_service.py::test_build_prompt_seo_keywords PASSED [ 81%]
tests/services/test_step_retry_service.py::test_build_prompt_seo_keywords_with_user_guidance PASSED [ 81%]
tests/services/test_step_retry_service.py::test_build_prompt_marketing_brief PASSED [ 81%]
tests/services/test_step_retry_service.py::test_build_prompt_article_generation FAILED [ 82%]
tests/services/test_step_retry_service.py::test_build_prompt_seo_optimization PASSED [ 82%]
tests/services/test_step_retry_service.py::test_build_prompt_suggested_links PASSED [ 82%]
tests/services/test_step_retry_service.py::test_build_prompt_content_formatting PASSED [ 82%]
tests/services/test_step_retry_service.py::test_build_prompt_design_kit PASSED [ 82%]
tests/services/test_step_retry_service.py::test_build_prompt_fallback PASSED [ 82%]
tests/services/test_step_retry_service.py::test_get_retry_service_singleton PASSED [ 83%]
tests/test_logging_config.py::test_log_level_from_environment PASSED     [ 83%]
tests/test_logging_config.py::test_logging_config_structure PASSED       [ 83%]
tests/test_logging_config.py::test_logging_config_formatters PASSED      [ 83%]
tests/test_logging_config.py::test_logging_config_handlers PASSED        [ 83%]
tests/test_logging_config.py::test_logging_config_loggers PASSED         [ 83%]
tests/test_logging_config.py::test_langchain_logging_callback_handler_init PASSED [ 84%]
tests/test_logging_config.py::test_langchain_logging_callback_handler_llm_start PASSED [ 84%]
tests/test_logging_config.py::test_langchain_logging_callback_handler_llm_end PASSED [ 84%]
tests/test_logging_config.py::test_langchain_logging_callback_handler_llm_error PASSED [ 84%]
tests/test_logging_config.py::test_logging_config_applied PASSED         [ 84%]
tests/test_main.py::test_cli_group PASSED                                [ 84%]
tests/test_main.py::test_run_pipeline_command PASSED                     [ 85%]
tests/test_main.py::test_serve_server_command PASSED                     [ 85%]
tests/test_main.py::test_serve_server_default_options PASSED             [ 85%]
tests/test_main.py::test_content_sources_command_list PASSED             [ 85%]
tests/test_main.py::test_content_sources_command_status PASSED           [ 85%]
tests/test_main.py::test_content_sources_command_test PASSED             [ 85%]
tests/test_main.py::test_content_sources_command_fetch PASSED            [ 86%]
tests/test_main.py::test_content_sources_async_list_sources FAILED       [ 86%]
tests/test_main.py::test_content_sources_async_check_status PASSED       [ 86%]
tests/test_main.py::test_content_sources_async_test_sources FAILED       [ 86%]
tests/test_main.py::test_content_sources_async_fetch_content PASSED      [ 86%]
tests/test_main.py::test_content_sources_async_cleanup PASSED            [ 86%]
tests/test_models.py::test_email_context PASSED                          [ 87%]
tests/test_models.py::test_base_content_context PASSED                   [ 87%]
tests/test_models.py::test_transcript_context PASSED                     [ 87%]
tests/test_models.py::test_blog_post_context PASSED                      [ 87%]
tests/test_models.py::test_release_notes_context PASSED                  [ 87%]
tests/test_models.py::test_app_context_with_transcript PASSED            [ 88%]
tests/test_models.py::test_app_context_with_blog_post PASSED             [ 88%]
tests/test_models.py::test_app_context_with_release_notes PASSED         [ 88%]
tests/test_ocr.py::test_extract_images_from_content PASSED               [ 88%]
tests/test_ocr.py::test_validate_image_url PASSED                        [ 88%]
tests/test_ocr.py::test_extract_text_from_image PASSED                   [ 88%]
tests/test_ocr.py::test_extract_text_from_url PASSED                     [ 89%]
tests/test_ocr.py::test_process_content_images PASSED                    [ 89%]
tests/test_ocr.py::test_enhance_content_with_ocr PASSED                  [ 89%]
tests/test_ocr.py::test_enhance_content_with_ocr_transcript PASSED       [ 89%]
tests/test_ocr.py::test_enhance_content_with_ocr_release_notes PASSED    [ 89%]
tests/test_parsers.py::test_parse_datetime PASSED                        [ 89%]
tests/test_parsers.py::test_clean_text PASSED                            [ 90%]
tests/test_parsers.py::test_parse_transcript FAILED                      [ 90%]
tests/test_parsers.py::test_parse_transcript_webvtt_format PASSED        [ 90%]
tests/test_parsers.py::test_parse_transcript_webvtt_removes_line_numbers PASSED [ 90%]
tests/test_parsers.py::test_parse_transcript_webvtt_removes_metadata PASSED [ 90%]
tests/test_parsers.py::test_parse_transcript_webvtt_calculates_duration PASSED [ 90%]
tests/test_parsers.py::test_parse_transcript_webvtt_extracts_speakers PASSED [ 91%]
tests/test_parsers.py::test_parse_transcript_detects_transcript_type PASSED [ 91%]
tests/test_parsers.py::test_parse_transcript_simple_format_still_works FAILED [ 91%]
tests/test_parsers.py::test_parse_blog_post PASSED                       [ 91%]
tests/test_parsers.py::test_parse_release_notes PASSED                   [ 91%]
tests/test_parsers.py::test_extract_metadata_from_content PASSED         [ 91%]
tests/test_runner.py::test_run_function_pipeline_no_content PASSED       [ 92%]
tests/test_runner.py::test_run_function_pipeline_with_blog_post PASSED   [ 92%]
tests/test_runner.py::test_run_function_pipeline_with_transcript PASSED  [ 92%]
tests/test_runner.py::test_run_function_pipeline_with_release_notes PASSED [ 92%]
tests/test_runner.py::test_run_function_pipeline_handles_errors PASSED   [ 92%]
tests/test_runner.py::test_run_single_content_blog_post PASSED           [ 92%]
tests/test_runner.py::test_run_single_content_transcript PASSED          [ 93%]
tests/test_runner.py::test_run_single_content_release_notes PASSED       [ 93%]
tests/test_runner.py::test_run_single_content_invalid_type PASSED        [ 93%]
tests/test_runner.py::test_build_fastapi_app PASSED                      [ 93%]
tests/test_runner.py::test_build_fastapi_app_endpoints PASSED            [ 93%]
tests/test_runner.py::test_run_server PASSED                             [ 94%]
tests/test_scheduler.py::test_scheduler_initialization PASSED            [ 94%]
tests/test_scheduler.py::test_scheduler_job_scheduling PASSED            [ 94%]
tests/test_scheduler.py::test_scheduler_shutdown PASSED                  [ 94%]
tests/test_server.py::test_app_initialization PASSED                     [ 94%]
tests/test_server.py::test_app_servers_configuration PASSED              [ 94%]
tests/test_server.py::test_custom_openapi FAILED                         [ 95%]
tests/test_server.py::test_custom_openapi_cached PASSED                  [ 95%]
tests/test_server.py::test_app_middleware_configured PASSED              [ 95%]
tests/test_server.py::test_app_router_included PASSED                    [ 95%]
tests/test_server.py::test_lifespan_startup FAILED                       [ 95%]
tests/test_server.py::test_lifespan_startup_no_database FAILED           [ 95%]
tests/test_server.py::test_lifespan_startup_database_error FAILED        [ 96%]
tests/test_server.py::test_lifespan_shutdown FAILED                      [ 96%]
tests/test_server.py::test_lifespan_shutdown_handles_errors FAILED       [ 96%]
tests/test_server.py::test_app_endpoints_accessible PASSED               [ 96%]
tests/test_server.py::test_cors_configuration_from_env PASSED            [ 96%]
tests/test_server.py::test_cors_allow_credentials_from_env PASSED        [ 96%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_valid PASSED [ 97%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_minimum PASSED [ 97%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_maximum PASSED [ 97%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_too_short PASSED [ 97%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_too_long PASSED [ 97%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_empty PASSED [ 97%]
tests/test_validation.py::TestValidateContentLength::test_validate_content_length_none PASSED [ 98%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_valid PASSED [ 98%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_with_underscores PASSED [ 98%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_mixed_separators PASSED [ 98%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_too_short PASSED [ 98%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_invalid_characters PASSED [ 98%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_empty PASSED [ 99%]
tests/test_validation.py::TestValidateApiKeyFormat::test_validate_api_key_format_none PASSED [ 99%]
tests/worker/test_worker.py::TestProcessBlogJob::test_process_blog_job_success PASSED [ 99%]
tests/worker/test_worker.py::TestProcessBlogJob::test_process_blog_job_error PASSED [ 99%]
tests/worker/test_worker.py::TestProcessReleaseNotesJob::test_process_release_notes_job_success PASSED [ 99%]
tests/worker/test_worker.py::TestProcessTranscriptJob::test_process_transcript_job_success PASSED [100%]

==================================== ERRORS ====================================
____ ERROR at setup of TestPipelineEndpoint.test_run_pipeline_success_blog _____
tests/api/test_core_endpoints.py:46: in pipeline_request
    return PipelineRequest(content=sample_content)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic.errors.PydanticUserError: `PipelineRequest` is not fully defined; you should define `PipelineConfig`, then call `PipelineRequest.model_rebuild()`.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
___ ERROR at setup of TestPipelineEndpoint.test_run_pipeline_processor_error ___
tests/api/test_core_endpoints.py:46: in pipeline_request
    return PipelineRequest(content=sample_content)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic.errors.PydanticUserError: `PipelineRequest` is not fully defined; you should define `PipelineConfig`, then call `PipelineRequest.model_rebuild()`.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
___ ERROR at setup of TestPipelineEndpoint.test_run_pipeline_execution_error ___
tests/api/test_core_endpoints.py:46: in pipeline_request
    return PipelineRequest(content=sample_content)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic.errors.PydanticUserError: `PipelineRequest` is not fully defined; you should define `PipelineConfig`, then call `PipelineRequest.model_rebuild()`.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
=================================== FAILURES ===================================
_________________________ test_decide_approval_reject __________________________
tests/api/test_approvals.py:271: in test_decide_approval_reject
    assert response.status_code in [200, 404, 500]
E   assert 400 in [200, 404, 500]
E    +  where 400 = <Response [400 Bad Request]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:29 [INFO] marketing_project.middleware.logging: Request eccf4fb5-da4c-44cb-808b-0ac696e091f2: POST /api/v1/approvals/test-approval-1/decide
2025-12-04 17:27:29 [INFO] marketing_project.api.approvals: Approval test-approval-1 decided: reject by test_user
2025-12-04 17:27:29 [WARNING] marketing_project.middleware.logging: Response eccf4fb5-da4c-44cb-808b-0ac696e091f2: 400 - 0.005s
2025-12-04 17:27:29 [INFO] httpx: HTTP Request: POST http://testserver/api/v1/approvals/test-approval-1/decide "HTTP/1.1 400 Bad Request"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v1/approvals/test-approval-1/decide "HTTP/1.1 400 Bad Request"
________________________ test_get_all_approvals_for_job ________________________
tests/api/test_approvals.py:287: in test_get_all_approvals_for_job
    assert response.status_code in [200, 500]
E   assert 404 in [200, 500]
E    +  where 404 = <Response [404 Not Found]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:29 [INFO] marketing_project.middleware.logging: Request fa17b9bd-8b7a-4187-acb7-89a359c6a04f: GET /api/v1/approvals/jobs/test-job-1/all
2025-12-04 17:27:29 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/base.py:149> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:29 [ERROR] marketing_project.services.job_manager: Error reading job test-job-1 from Redis (key: job:test-job-1): RuntimeError: Event loop is closed
2025-12-04 17:27:29 [WARNING] marketing_project.middleware.logging: Response fa17b9bd-8b7a-4187-acb7-89a359c6a04f: 404 - 0.002s
2025-12-04 17:27:29 [INFO] httpx: HTTP Request: GET http://testserver/api/v1/approvals/jobs/test-job-1/all "HTTP/1.1 404 Not Found"
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:29 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/base.py:149> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:29 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-job-1 from Redis (key: job:test-job-1): RuntimeError: Event loop is closed
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/approvals/jobs/test-job-1/all "HTTP/1.1 404 Not Found"
___________________________ test_retry_rejected_step ___________________________
tests/api/test_approvals.py:353: in test_retry_rejected_step
    with patch(
/opt/anaconda3/lib/python3.12/unittest/mock.py:1463: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1436: in get_original
    raise AttributeError(
E   AttributeError: <module 'marketing_project.api.approvals' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/api/approvals.py'> does not have the attribute 'get_retry_service'
________________________ test_get_design_kit_templates _________________________
tests/api/test_design_kit.py:126: in test_get_design_kit_templates
    assert response.status_code in [200, 500]
E   assert 404 in [200, 500]
E    +  where 404 = <Response [404 Not Found]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:30 [INFO] marketing_project.middleware.logging: Request dbc69c5d-4953-4ccf-89e7-0677df90f0cc: GET /api/v1/design-kit/templates
2025-12-04 17:27:30 [WARNING] marketing_project.middleware.logging: Response dbc69c5d-4953-4ccf-89e7-0677df90f0cc: 404 - 0.001s
2025-12-04 17:27:30 [INFO] httpx: HTTP Request: GET http://testserver/api/v1/design-kit/templates "HTTP/1.1 404 Not Found"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/design-kit/templates "HTTP/1.1 404 Not Found"
__________________________ test_get_design_kit_assets __________________________
tests/api/test_design_kit.py:141: in test_get_design_kit_assets
    assert response.status_code in [200, 500]
E   assert 404 in [200, 500]
E    +  where 404 = <Response [404 Not Found]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:30 [INFO] marketing_project.middleware.logging: Request 59e6e1e9-8db1-470a-bbcb-7be3765530ad: GET /api/v1/design-kit/assets
2025-12-04 17:27:30 [WARNING] marketing_project.middleware.logging: Response 59e6e1e9-8db1-470a-bbcb-7be3765530ad: 404 - 0.001s
2025-12-04 17:27:30 [INFO] httpx: HTTP Request: GET http://testserver/api/v1/design-kit/assets "HTTP/1.1 404 Not Found"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/design-kit/assets "HTTP/1.1 404 Not Found"
___________________ test_get_internal_docs_config_not_found ____________________
tests/api/test_internal_docs.py:61: in test_get_internal_docs_config_not_found
    assert response.status_code in [404, 500]
E   assert 200 in [404, 500]
E    +  where 200 = <Response [200 OK]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:30 [INFO] marketing_project.middleware.logging: Request 41bee7bc-528b-4482-b3fb-44fea05b1c81: GET /api/v1/internal-docs/config
2025-12-04 17:27:30 [INFO] marketing_project.middleware.logging: Response 41bee7bc-528b-4482-b3fb-44fea05b1c81: 200 - 0.001s
2025-12-04 17:27:30 [INFO] httpx: HTTP Request: GET http://testserver/api/v1/internal-docs/config "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/internal-docs/config "HTTP/1.1 200 OK"
___________________________ test_scan_internal_docs ____________________________
tests/api/test_internal_docs.py:85: in test_scan_internal_docs
    assert response.status_code in [200, 500]
E   assert 404 in [200, 500]
E    +  where 404 = <Response [404 Not Found]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:30 [INFO] marketing_project.middleware.logging: Request 2e049808-1e1c-41cd-ad49-e19da7debce8: POST /api/v1/internal-docs/scan
2025-12-04 17:27:30 [WARNING] marketing_project.middleware.logging: Response 2e049808-1e1c-41cd-ad49-e19da7debce8: 404 - 0.002s
2025-12-04 17:27:30 [INFO] httpx: HTTP Request: POST http://testserver/api/v1/internal-docs/scan "HTTP/1.1 404 Not Found"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v1/internal-docs/scan "HTTP/1.1 404 Not Found"
____________ TestEndToEndPipeline.test_linkedin_pipeline_execution _____________
tests/integration/test_social_media_pipeline_integration.py:67: in test_linkedin_pipeline_execution
    assert "social_media_marketing_brief" in step_results
E   AssertionError: assert 'social_media_marketing_brief' in {'seo_keywords': {'confidence_score': 1.0, 'keyword_clusters': None, 'keyword_density': {'keyword': 0.0}, 'keyword_density_analysis': [{'current_density': 0.0, 'keyword': 'keyword', 'occurrences': 0, 'optimal_density': 2.0, ...}], ...}}
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:37 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:37 [INFO] marketing_project.services.social_media_pipeline: Starting Social Media Pipeline (job_id: test-linkedin-1, platform: linkedin)
2025-12-04 17:27:37 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:37 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:37 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: seo_keywords
2025-12-04 17:27:38 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] marketing_project.services.engines.composer: Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [WARNING] marketing_project.services.engines.seo_keywords.composer: LLM extraction failed, falling back to field-by-field: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
2025-12-04 17:27:38 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:38 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_seo_keywords.json for job test-linkedin-1 (context: 0, root: test-linkedin-1)
2025-12-04 17:27:38 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: social_media_marketing_brief
2025-12-04 17:27:38 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Social Media Pipeline failed after 0.70s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.engines.composer:execute_operation:127] Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:execute_pipeline:1236] Social Media Pipeline failed after 0.70s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
___________ TestEndToEndPipeline.test_hackernews_pipeline_execution ____________
tests/integration/test_social_media_pipeline_integration.py:102: in test_hackernews_pipeline_execution
    assert post_result.get("platform") == "hackernews"
E   AssertionError: assert None == 'hackernews'
E    +  where None = <built-in method get of dict object at 0x31b677f40>('platform')
E    +    where <built-in method get of dict object at 0x31b677f40> = {}.get
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Starting Social Media Pipeline (job_id: test-hackernews-1, platform: hackernews)
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:38 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1115' coro=<TestEndToEndPipeline.test_hackernews_pipeline_execution() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:86> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:38 [ERROR] marketing_project.services.job_manager: Error reading job test-hackernews-1 from Redis (key: job:test-hackernews-1): RuntimeError: Event loop is closed
2025-12-04 17:27:38 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: seo_keywords
2025-12-04 17:27:38 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:38 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] marketing_project.services.engines.composer: Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [WARNING] marketing_project.services.engines.seo_keywords.composer: LLM extraction failed, falling back to field-by-field: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
2025-12-04 17:27:38 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_seo_keywords.json for job test-hackernews-1 (context: 0, root: test-hackernews-1)
2025-12-04 17:27:38 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: social_media_marketing_brief
2025-12-04 17:27:38 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Social Media Pipeline failed after 0.30s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:38 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1115' coro=<TestEndToEndPipeline.test_hackernews_pipeline_execution() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:86> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:38 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-hackernews-1 from Redis (key: job:test-hackernews-1): RuntimeError: Event loop is closed
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.engines.composer:execute_operation:127] Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:execute_pipeline:1236] Social Media Pipeline failed after 0.30s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
________ TestEndToEndPipeline.test_email_pipeline_execution_newsletter _________
tests/integration/test_social_media_pipeline_integration.py:130: in test_email_pipeline_execution_newsletter
    assert post_result.get("platform") == "email"
E   AssertionError: assert None == 'email'
E    +  where None = <built-in method get of dict object at 0x31b6da1c0>('platform')
E    +    where <built-in method get of dict object at 0x31b6da1c0> = {}.get
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Starting Social Media Pipeline (job_id: test-email-newsletter-1, platform: email)
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:38 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1119' coro=<TestEndToEndPipeline.test_email_pipeline_execution_newsletter() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:115> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:38 [ERROR] marketing_project.services.job_manager: Error reading job test-email-newsletter-1 from Redis (key: job:test-email-newsletter-1): RuntimeError: Event loop is closed
2025-12-04 17:27:38 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: seo_keywords
2025-12-04 17:27:38 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:38 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:38 [ERROR] marketing_project.services.social_media_pipeline: Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] marketing_project.services.engines.composer: Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [WARNING] marketing_project.services.engines.seo_keywords.composer: LLM extraction failed, falling back to field-by-field: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:38 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
2025-12-04 17:27:38 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_seo_keywords.json for job test-email-newsletter-1 (context: 0, root: test-email-newsletter-1)
2025-12-04 17:27:38 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:38 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: social_media_marketing_brief
2025-12-04 17:27:39 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:39 [ERROR] marketing_project.services.social_media_pipeline: Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:39 [ERROR] marketing_project.services.social_media_pipeline: Social Media Pipeline failed after 0.35s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:38 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1119' coro=<TestEndToEndPipeline.test_email_pipeline_execution_newsletter() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:115> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:38 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-email-newsletter-1 from Redis (key: job:test-email-newsletter-1): RuntimeError: Event loop is closed
2025-12-04 17:27:38 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:38 [ERROR] [marketing_project.services.engines.composer:execute_operation:127] Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:39 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:39 [ERROR] [marketing_project.services.social_media_pipeline:execute_pipeline:1236] Social Media Pipeline failed after 0.35s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
_____________ TestContentValidation.test_content_length_validation _____________
tests/integration/test_social_media_pipeline_integration.py:329: in test_content_length_validation
    assert any("limit" in str(w).lower() for w in warnings)
E   assert False
E    +  where False = any(<generator object TestContentValidation.test_content_length_validation.<locals>.<genexpr> at 0x31b670660>)
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:40 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:40 [INFO] marketing_project.services.social_media_pipeline: Starting Social Media Pipeline (job_id: test-long-content, platform: linkedin)
2025-12-04 17:27:40 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:40 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.001s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1153' coro=<TestContentValidation.test_content_length_validation() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:317> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:40 [ERROR] marketing_project.services.job_manager: Error reading job test-long-content from Redis (key: job:test-long-content): RuntimeError: Event loop is closed
2025-12-04 17:27:40 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:40 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: seo_keywords
2025-12-04 17:27:40 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:41 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] marketing_project.services.engines.composer: Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [WARNING] marketing_project.services.engines.seo_keywords.composer: LLM extraction failed, falling back to field-by-field: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
2025-12-04 17:27:41 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_seo_keywords.json for job test-long-content (context: 0, root: test-long-content)
2025-12-04 17:27:41 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: social_media_marketing_brief
2025-12-04 17:27:41 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Social Media Pipeline failed after 0.36s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:40 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.001s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1153' coro=<TestContentValidation.test_content_length_validation() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:317> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:40 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-long-content from Redis (key: job:test-long-content): RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.engines.composer:execute_operation:127] Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:execute_pipeline:1236] Social Media Pipeline failed after 0.36s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
_____________ TestPlatformSpecificFeatures.test_linkedin_hashtags ______________
tests/integration/test_social_media_pipeline_integration.py:357: in test_linkedin_hashtags
    assert "hashtags" in post_result or post_result.get("platform") == "linkedin"
E   AssertionError: assert ('hashtags' in {} or None == 'linkedin')
E    +  where None = <built-in method get of dict object at 0x31d6af940>('platform')
E    +    where <built-in method get of dict object at 0x31d6af940> = {}.get
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Starting Social Media Pipeline (job_id: test-hashtags, platform: linkedin)
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:41 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1157' coro=<TestPlatformSpecificFeatures.test_linkedin_hashtags() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:346> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] marketing_project.services.job_manager: Error reading job test-hashtags from Redis (key: job:test-hashtags): RuntimeError: Event loop is closed
2025-12-04 17:27:41 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: seo_keywords
2025-12-04 17:27:41 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:41 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] marketing_project.services.engines.composer: Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [WARNING] marketing_project.services.engines.seo_keywords.composer: LLM extraction failed, falling back to field-by-field: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
2025-12-04 17:27:41 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_seo_keywords.json for job test-hashtags (context: 0, root: test-hashtags)
2025-12-04 17:27:41 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: social_media_marketing_brief
2025-12-04 17:27:41 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Social Media Pipeline failed after 0.32s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:41 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1157' coro=<TestPlatformSpecificFeatures.test_linkedin_hashtags() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:346> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-hashtags from Redis (key: job:test-hashtags): RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.engines.composer:execute_operation:127] Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:execute_pipeline:1236] Social Media Pipeline failed after 0.32s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
_____________ TestPlatformSpecificFeatures.test_email_subject_line _____________
tests/integration/test_social_media_pipeline_integration.py:382: in test_email_subject_line
    assert "subject_line" in post_result
E   AssertionError: assert 'subject_line' in {}
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Starting Social Media Pipeline (job_id: test-subject, platform: email)
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: ================================================================================
2025-12-04 17:27:41 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.002s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1161' coro=<TestPlatformSpecificFeatures.test_email_subject_line() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:370> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] marketing_project.services.job_manager: Error reading job test-subject from Redis (key: job:test-subject): RuntimeError: Event loop is closed
2025-12-04 17:27:41 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: seo_keywords
2025-12-04 17:27:41 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:41 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] marketing_project.services.engines.composer: Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [WARNING] marketing_project.services.engines.seo_keywords.composer: LLM extraction failed, falling back to field-by-field: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:41 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
2025-12-04 17:27:41 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_seo_keywords.json for job test-subject (context: 0, root: test-subject)
2025-12-04 17:27:41 [INFO] marketing_project.services.context_registry: Context Registry initialized with local filesystem, base_dir: context_registry, compression: True
2025-12-04 17:27:41 [INFO] marketing_project.services.social_media_pipeline: Executing step 2: social_media_marketing_brief
2025-12-04 17:27:41 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] marketing_project.services.social_media_pipeline: Social Media Pipeline failed after 0.30s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:41 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.002s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1161' coro=<TestPlatformSpecificFeatures.test_email_subject_line() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/integration/test_social_media_pipeline_integration.py:370> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-subject from Redis (key: job:test-subject): RuntimeError: Event loop is closed
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: seo_keywords failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.engines.composer:execute_operation:127] Error executing operation 'extract_all' for field 'main_keyword': Error code: 400 - {'error': {'message': "Invalid schema for response_format 'seo_keywords': In context=(), 'required' is required to be supplied and to be an array including every key in properties. Missing 'primary_keyword'.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:_call_function:748] Step 2: social_media_marketing_brief failed: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
2025-12-04 17:27:41 [ERROR] [marketing_project.services.social_media_pipeline:execute_pipeline:1236] Social Media Pipeline failed after 0.30s: Error code: 400 - {'error': {'message': "Invalid schema for response_format 'social_media_marketing_brief': In context=('properties', 'platform_specific_notes', 'anyOf', '0'), 'additionalProperties' is required to be supplied and to be false.", 'type': 'invalid_request_error', 'param': 'response_format', 'code': None}}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 400 Bad Request"
________________ test_trusted_host_middleware_no_allowed_hosts _________________
tests/middleware/test_trusted_host.py:153: in test_trusted_host_middleware_no_allowed_hosts
    assert response.status_code == 200
E   assert 400 == 200
E    +  where 400 = <Response [400 Bad Request]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [WARNING] marketing_project.middleware.trusted_host: Rejected request from untrusted host: any-host.com
2025-12-04 17:27:42 [INFO] httpx: HTTP Request: GET http://testserver/test "HTTP/1.1 400 Bad Request"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/test "HTTP/1.1 400 Bad Request"
_______________ test_trusted_host_middleware_missing_host_header _______________
tests/middleware/test_trusted_host.py:189: in test_trusted_host_middleware_missing_host_header
    assert response.status_code == 400
E   assert 200 == 400
E    +  where 200 = <Response [200 OK]>.status_code
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [INFO] httpx: HTTP Request: GET http://testserver/test "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/test "HTTP/1.1 200 OK"
_________________ TestArticleGenerationPlugin.test_step_number _________________
tests/plugins/test_article_generation_plugin.py:51: in test_step_number
    assert article_generation_plugin.step_number == 3
E   assert 4 == 3
E    +  where 4 = <marketing_project.plugins.article_generation.tasks.ArticleGenerationPlugin object at 0x31d6e3620>.step_number
_____________ TestAnalyzeContentType.test_analyze_generic_content ______________
tests/plugins/test_content_analysis.py:71: in test_analyze_generic_content
    assert result == "general_agent"
E   AssertionError: assert 'blog_agent' == 'general_agent'
E
E     - general_agent
E     + blog_agent
___________ TestAnalyzeContentForPipeline.test_analyze_valid_content ___________
tests/plugins/test_content_analysis.py:159: in test_analyze_valid_content
    assert result["success"] is True
E   assert False is True
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [ERROR] marketing_project.plugins.content_analysis: Error in analyze_content_for_pipeline: 'BlogPostContext' object has no attribute 'reading_time'
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:42 [ERROR] [marketing_project.plugins.content_analysis:analyze_content_for_pipeline:228] Error in analyze_content_for_pipeline: 'BlogPostContext' object has no attribute 'reading_time'
_____________ TestIntegration.test_full_content_analysis_workflow ______________
tests/plugins/test_content_analysis.py:496: in test_full_content_analysis_workflow
    assert analysis["success"] is True
E   assert False is True
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [ERROR] marketing_project.plugins.content_analysis: Error in analyze_content_for_pipeline: 'BlogPostContext' object has no attribute 'reading_time'
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:27:42 [ERROR] [marketing_project.plugins.content_analysis:analyze_content_for_pipeline:228] Error in analyze_content_for_pipeline: 'BlogPostContext' object has no attribute 'reading_time'
_________________ TestContentFormattingPlugin.test_step_number _________________
tests/plugins/test_content_formatting_plugin.py:44: in test_step_number
    assert content_formatting_plugin.step_number == 6
E   assert 8 == 6
E    +  where 8 = <marketing_project.plugins.content_formatting.tasks.ContentFormattingPlugin object at 0x31b606d80>.step_number
__________________ TestMarketingBriefPlugin.test_step_number ___________________
tests/plugins/test_marketing_brief_plugin.py:46: in test_step_number
    assert marketing_brief_plugin.step_number == 2
E   assert 3 == 2
E    +  where 3 = <marketing_project.plugins.marketing_brief.tasks.MarketingBriefPlugin object at 0x319f82810>.step_number
____________________ TestSEOKeywordsPlugin.test_step_number ____________________
tests/plugins/test_seo_keywords_plugin.py:42: in test_step_number
    assert seo_keywords_plugin.step_number == 1
E   assert 2 == 1
E    +  where 2 = <marketing_project.plugins.seo_keywords.tasks.SEOKeywordsPlugin object at 0x31d6e7830>.step_number
______________________ TestSEOKeywordsPlugin.test_execute ______________________
tests/plugins/test_seo_keywords_plugin.py:85: in test_execute
    mock_pipeline._call_function.assert_called_once()
/opt/anaconda3/lib/python3.12/unittest/mock.py:928: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected '_call_function' to have been called once. Called 0 times.
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:42 [WARNING] marketing_project.plugins.seo_keywords: Only 1 primary keywords, minimum is 3
2025-12-04 17:27:42 [WARNING] marketing_project.plugins.seo_keywords: Only 0 LSI keywords, minimum is 5
2025-12-04 17:27:42 [WARNING] marketing_project.plugins.seo_keywords: SEO keywords validation issues: ['Need at least 3 primary keywords, got 1']
__________________ TestSEOOptimizationPlugin.test_step_number __________________
tests/plugins/test_seo_optimization_plugin.py:58: in test_step_number
    assert seo_optimization_plugin.step_number == 4
E   assert 5 == 4
E    +  where 5 = <marketing_project.plugins.seo_optimization.tasks.SEOOptimizationPlugin object at 0x31d69c440>.step_number
__________________ TestSuggestedLinksPlugin.test_step_number ___________________
tests/plugins/test_suggested_links_plugin.py:59: in test_step_number
    assert suggested_links_plugin.step_number == 5
E   assert 6 == 5
E    +  where 6 = <marketing_project.plugins.suggested_links.tasks.SuggestedLinksPlugin object at 0x31d69f3e0>.step_number
___________ test_check_and_create_approval_request_approval_required ___________
tests/processors/test_approval_helper.py:96: in test_check_and_create_approval_request_approval_required
    with pytest.raises(ApprovalRequiredException) as exc_info:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   Failed: DID NOT RAISE <class 'marketing_project.processors.approval_helper.ApprovalRequiredException'>
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Checking if seo_keywords requires approval. Enabled agents: <AsyncMock name='mock.settings.approval_agents' id='13378658208'>
2025-12-04 17:27:42 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Agent 'seo_keywords' not in approval_agents list (<AsyncMock name='mock.settings.approval_agents' id='13378658208'>), skipping approval
__________________________ test_prepare_approval_data __________________________
tests/processors/test_approval_helper.py:159: in test_prepare_approval_data
    assert "input" in result
E   AssertionError: assert 'input' in ({'content': {'title': 'Test'}}, {'keywords': ['test']})
__________________ test_prepare_approval_data_with_confidence __________________
tests/processors/test_approval_helper.py:170: in test_prepare_approval_data_with_confidence
    result = prepare_approval_data(
E   TypeError: prepare_approval_data() got an unexpected keyword argument 'confidence_score'
_________________ test_prepare_approval_data_with_suggestions __________________
tests/processors/test_approval_helper.py:185: in test_prepare_approval_data_with_suggestions
    result = prepare_approval_data(
E   TypeError: prepare_approval_data() got an unexpected keyword argument 'suggestions'
____________ TestBlogProcessor.test_process_blog_post_invalid_input ____________
tests/processors/test_blog_processor.py:88: in test_process_blog_post_invalid_input
    assert result["status"] == "error"
E   AssertionError: assert 'success' == 'error'
E
E     - error
E     + success
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:27:42 [INFO] marketing_project.processors: Blog Processor: Parsing input data
2025-12-04 17:27:42 [INFO] marketing_project.processors: Blog Processor: Processing blog post ''
2025-12-04 17:27:42 [INFO] marketing_project.processors: Blog Processor: Routing to appropriate pipeline
2025-12-04 17:27:42 [INFO] marketing_project.processors: Blog Processor: Running function-based pipeline
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: ================================================================================
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Starting Function Pipeline (job_id: 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd, type: blog_post)
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: ================================================================================
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Loaded internal docs configuration
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Loaded design kit configuration
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Function Pipeline: Processing blog_post (output_content_type=blog_post)
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Skipping step transcript_preprocessing_approval (not transcript content)
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Executing step 1/7: blog_post_preprocessing_approval
2025-12-04 17:27:42 [INFO] marketing_project.plugins.blog_post_preprocessing_approval: Executing blog post preprocessing approval step
2025-12-04 17:27:42 [INFO] marketing_project.services.function_pipeline: Step 1: blog_post_preprocessing_approval (attempt 1/2, model: gpt-5.1)
2025-12-04 17:27:53 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:27:53 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Checking approval for step 1 (blog_post_preprocessing_approval) in job 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd
2025-12-04 17:27:53 [INFO] marketing_project.services.approval_manager: Loaded approval settings from database/Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 6db6c784-401e-46e1-b555-98260a2a9489 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval adc41095-9bc8-4c7a-89e0-d67be0ffbe07 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 16ba6140-5a90-4de6-9445-c423f20e9711 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 0dba0006-3cdd-45d3-8da5-b20954f76549 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval f379f690-e0ae-4d1a-b09b-fecb598a1591 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 67fd6a08-5832-423e-b5c5-98e83878b38a from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 318b842f-f690-4611-b976-86ca525cabc7 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 3d321fa8-87bd-4184-8c08-e2b8e72db69c from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 3cbc6955-d37e-41d9-a2c5-a7a4ff22ff04 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 4e5dabb5-2caf-4714-ba30-0c2f15b1d53d from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 39c55266-40c2-4f6a-b0a9-1ed65f2a9692 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 3a371b8c-3b0d-402c-986c-7d841ed65a2c from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 7a6f6efd-41ef-4727-aeae-beac2d8dffaf from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 6c846bc7-c9d4-4b5b-b19b-15915e4f295a from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 711aa1bd-5759-4302-bd1f-21fd0eb3729a from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval ca331444-e852-4e5c-aeda-e1ea5aa53622 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 0c0d4cf2-1b1e-4f81-b689-a5eca1c8838c from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 0c970fce-306f-44ca-a21f-6f73f695a007 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 275a5260-ba7d-46d8-9b62-4bcfc7a036a4 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 14d432cc-5b02-4364-b933-51f4c5148ae4 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 664d4c01-9e65-470e-826b-f4dcd73247bb from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 82aebd38-9135-418e-96f2-d48f30b54f96 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 57f90f75-8b13-4823-ba60-4a1abdcf7db9 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval d865ab3a-8bed-4dc3-a17f-b305c1571a3b from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 45309928-da63-4d33-989f-e54b7cbf37b4 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 35e75a2c-82c7-4964-871e-23d85f94e7b7 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval b1ba8d80-f202-4309-a997-86d41aaf40f8 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 109bddb1-cc09-41ff-a5ac-a54649546cd3 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 5a420100-e15b-4ee9-8cad-1fa8dbc63192 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 84169dde-0229-4310-8937-7dcbd5806d2b from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval a12a58bf-0360-434b-b1d3-2c915d3ee8c3 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 08ce6868-a08d-45ed-811e-f1b858c37a4b from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 0813a68f-4c3a-4099-936b-89ed7a942a7d from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval b66dabf4-75a2-4967-b879-0206a8ee1d19 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 8bead6c3-be8c-488e-97d3-81970979f31c from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval f1858510-bd57-47c4-92c1-ac01a68bb188 from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval d0d93068-69b3-4f80-9572-402780f8cefb from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval 5dc51789-8b97-48e2-bc28-4d246dac2bdb from Redis
2025-12-04 17:27:53 [WARNING] marketing_project.services.approval_manager: Failed to load approval fec1e27d-81f3-4f6f-bd65-59e11299e907 from Redis
2025-12-04 17:27:53 [INFO] marketing_project.services.approval_manager: Loaded 17 approval(s) from Redis (skipped 39 already in memory)
2025-12-04 17:27:53 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Checking if blog_post_preprocessing_approval requires approval. Enabled agents: ['article_generation', 'marketing_brief', 'seo_keywords', 'seo_optimization', 'content_formatting', 'content_pipeline', 'transcript_preprocessing_approval']
2025-12-04 17:27:53 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Agent 'blog_post_preprocessing_approval' not in approval_agents list (['article_generation', 'marketing_brief', 'seo_keywords', 'seo_optimization', 'content_formatting', 'content_pipeline', 'transcript_preprocessing_approval']), skipping approval
2025-12-04 17:27:53 [INFO] marketing_project.services.function_pipeline: [APPROVAL] No approval required for step 1 (blog_post_preprocessing_approval), continuing pipeline
2025-12-04 17:27:53 [WARNING] marketing_project.services.function_pipeline: Failed to save step result to disk for step 1: cannot access local variable 'copy' where it is not associated with a value
2025-12-04 17:27:53 [INFO] marketing_project.services.function_pipeline: Step 1 completed in 11.01s
2025-12-04 17:27:53 [INFO] marketing_project.plugins.blog_post_preprocessing_approval: Merged AI-calculated word_count into input_content: 0
2025-12-04 17:27:53 [INFO] marketing_project.plugins.blog_post_preprocessing_approval: Merged AI-calculated reading_time into input_content: 0 minutes
2025-12-04 17:27:53 [INFO] marketing_project.services.function_pipeline: Executing step 2/7: seo_keywords
2025-12-04 17:27:53 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:27:53 [INFO] marketing_project.services.function_pipeline: Step 2: seo_keywords (attempt 1/2, model: gpt-5.1)
2025-12-04 17:28:24 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:28:24 [INFO] marketing_project.services.function_pipeline: Step 2 completed in 31.12s
2025-12-04 17:28:24 [INFO] marketing_project.services.function_pipeline: Executing step 3/7: marketing_brief
2025-12-04 17:28:24 [INFO] marketing_project.services.function_pipeline: Step 3: marketing_brief (attempt 1/2, model: gpt-5.1)
2025-12-04 17:29:34 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Checking approval for step 3 (marketing_brief) in job 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd
2025-12-04 17:29:34 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Checking if marketing_brief requires approval. Enabled agents: ['article_generation', 'marketing_brief', 'seo_keywords', 'seo_optimization', 'content_formatting', 'content_pipeline', 'transcript_preprocessing_approval']
2025-12-04 17:29:34 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Agent 'marketing_brief' requires approval, creating approval request...
2025-12-04 17:29:34 [INFO] marketing_project.services.approval_manager: Created approval request 9031e83a-7ac2-43f0-aeca-33c0837870f6 for job 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd, agent marketing_brief
2025-12-04 17:29:34 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Created approval request 9031e83a-7ac2-43f0-aeca-33c0837870f6 for marketing_brief in job 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd. Pipeline will stop and wait for approval.
2025-12-04 17:29:34 [INFO] marketing_project.services.approval_manager: Saved pipeline context for job 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd at step 3 (Step 3: marketing_brief)
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Step 3 (marketing_brief) requires approval. Pipeline stopping. Approval ID: 9031e83a-7ac2-43f0-aeca-33c0837870f6
2025-12-04 17:29:34 [WARNING] marketing_project.services.function_pipeline: Failed to save step result to disk for step 3: cannot access local variable 'copy' where it is not associated with a value
2025-12-04 17:29:34 [ERROR] marketing_project.services.function_pipeline: Step 3 (marketing_brief) failed: Approval required for step 3: Step 3: marketing_brief (approval_id: 9031e83a-7ac2-43f0-aeca-33c0837870f6)
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Pipeline stopped for approval at step 3 (Step 3: marketing_brief) after 111.42s. Job 25aa822e-8b3d-4bb0-8c4b-4a3c4a8f05cd marked as WAITING_FOR_APPROVAL
2025-12-04 17:29:34 [INFO] marketing_project.processors: Blog Processor: Function pipeline completed successfully
2025-12-04 17:29:34 [INFO] marketing_project.processors: Blog Processor: Processing complete
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:29:34 [ERROR] [marketing_project.services.function_pipeline:execute_pipeline:1032] Step 3 (marketing_brief) failed: Approval required for step 3: Step 3: marketing_brief (approval_id: 9031e83a-7ac2-43f0-aeca-33c0837870f6)
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
______ TestReleaseNotesProcessor.test_process_release_notes_invalid_input ______
tests/processors/test_releasenotes_processor.py:89: in test_process_release_notes_invalid_input
    assert result["status"] == "error"
E   AssertionError: assert 'success' == 'error'
E
E     - error
E     + success
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:29:34 [INFO] marketing_project.processors: Release Notes Processor: Parsing input data
2025-12-04 17:29:34 [INFO] marketing_project.processors: Release Notes Processor: Processing release notes ''
2025-12-04 17:29:34 [INFO] marketing_project.processors: Release Notes Processor: Running function-based pipeline
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: ================================================================================
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Starting Function Pipeline (job_id: 90d192ac-f223-4f3c-87d8-17712f7fbf49, type: release_notes)
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: ================================================================================
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Loaded internal docs configuration
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Loaded design kit configuration
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Function Pipeline: Converting release_notes to blog_post
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Skipping step transcript_preprocessing_approval (not transcript content)
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Skipping step blog_post_preprocessing_approval (not blog_post content)
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Executing step 1/6: seo_keywords
2025-12-04 17:29:34 [WARNING] marketing_project.services.engines.registry: Engine type 'llm' already registered. Overwriting.
2025-12-04 17:29:34 [INFO] marketing_project.services.function_pipeline: Step 1: seo_keywords (attempt 1/2, model: gpt-5.1)
2025-12-04 17:29:58 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:29:58 [INFO] marketing_project.services.function_pipeline: Step 1 completed in 23.80s
2025-12-04 17:29:58 [INFO] marketing_project.services.function_pipeline: Executing step 2/6: marketing_brief
2025-12-04 17:29:58 [INFO] marketing_project.services.function_pipeline: Step 2: marketing_brief (attempt 1/2, model: gpt-5.1)
2025-12-04 17:30:43 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Checking approval for step 2 (marketing_brief) in job 90d192ac-f223-4f3c-87d8-17712f7fbf49
2025-12-04 17:30:43 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Checking if marketing_brief requires approval. Enabled agents: ['article_generation', 'marketing_brief', 'seo_keywords', 'seo_optimization', 'content_formatting', 'content_pipeline', 'transcript_preprocessing_approval']
2025-12-04 17:30:43 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Agent 'marketing_brief' requires approval, creating approval request...
2025-12-04 17:30:43 [INFO] marketing_project.services.approval_manager: Created approval request 5269e09f-0874-4721-bff1-8f59825b0d3d for job 90d192ac-f223-4f3c-87d8-17712f7fbf49, agent marketing_brief
2025-12-04 17:30:43 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Created approval request 5269e09f-0874-4721-bff1-8f59825b0d3d for marketing_brief in job 90d192ac-f223-4f3c-87d8-17712f7fbf49. Pipeline will stop and wait for approval.
2025-12-04 17:30:43 [INFO] marketing_project.services.approval_manager: Saved pipeline context for job 90d192ac-f223-4f3c-87d8-17712f7fbf49 at step 2 (Step 2: marketing_brief)
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Step 2 (marketing_brief) requires approval. Pipeline stopping. Approval ID: 5269e09f-0874-4721-bff1-8f59825b0d3d
2025-12-04 17:30:43 [WARNING] marketing_project.services.function_pipeline: Failed to save step result to disk for step 2: cannot access local variable 'copy' where it is not associated with a value
2025-12-04 17:30:43 [ERROR] marketing_project.services.function_pipeline: Step 2 (marketing_brief) failed: Approval required for step 2: Step 2: marketing_brief (approval_id: 5269e09f-0874-4721-bff1-8f59825b0d3d)
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Pipeline stopped for approval at step 2 (Step 2: marketing_brief) after 68.87s. Job 90d192ac-f223-4f3c-87d8-17712f7fbf49 marked as WAITING_FOR_APPROVAL
2025-12-04 17:30:43 [INFO] marketing_project.processors: Release Notes Processor: Function pipeline completed successfully
2025-12-04 17:30:43 [INFO] marketing_project.processors: Release Notes Processor: Processing complete
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:30:43 [ERROR] [marketing_project.services.function_pipeline:execute_pipeline:1032] Step 2 (marketing_brief) failed: Approval required for step 2: Step 2: marketing_brief (approval_id: 5269e09f-0874-4721-bff1-8f59825b0d3d)
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
________ TestTranscriptProcessor.test_process_transcript_invalid_input _________
tests/processors/test_transcript_processor.py:96: in test_process_transcript_invalid_input
    assert result["status"] == "error"
E   AssertionError: assert 'success' == 'error'
E
E     - error
E     + success
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:43 [INFO] marketing_project.processors: Transcript Processor: Parsing input data
2025-12-04 17:30:43 [INFO] marketing_project.processors: Transcript Processor: Processing transcript ''
2025-12-04 17:30:43 [INFO] marketing_project.processors: Transcript Processor: Running function-based pipeline with output_content_type=blog_post
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: ================================================================================
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Starting Function Pipeline (job_id: 69a4913a-297b-40be-82c5-4d90767277c2, type: transcript)
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: ================================================================================
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Loaded internal docs configuration
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Loaded design kit configuration
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Function Pipeline: Converting transcript to blog_post
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Skipping step blog_post_preprocessing_approval (not blog_post content)
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Executing step 1/7: transcript_preprocessing_approval
2025-12-04 17:30:43 [INFO] marketing_project.plugins.transcript_preprocessing_approval: Executing transcript preprocessing approval step (3 sequential LLM calls)
2025-12-04 17:30:43 [INFO] marketing_project.plugins.transcript_preprocessing_approval: Step 1/3: Extracting transcript content
2025-12-04 17:30:43 [INFO] marketing_project.services.function_pipeline: Step 1: transcript_content_extraction (attempt 1/2, model: gpt-5.1)
2025-12-04 17:30:45 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:30:45 [INFO] marketing_project.services.function_pipeline: Step 1 completed in 2.75s
2025-12-04 17:30:45 [WARNING] marketing_project.plugins.transcript_preprocessing_approval:  Step 1/3 PARTIAL: Content extraction completed but validation failed - 0 characters extracted, validation_issues=4, confidence=0.99
2025-12-04 17:30:45 [WARNING] marketing_project.plugins.transcript_preprocessing_approval:   Validation issues: No transcript text was provided in the raw input., Extracted content is empty and below the 100-character minimum length., Cannot determine speakers because there is no dialogue., Transcript type cannot be inferred from missing content.
2025-12-04 17:30:45 [INFO] marketing_project.plugins.transcript_preprocessing_approval: Step 2/3: Extracting speakers
2025-12-04 17:30:45 [INFO] marketing_project.services.function_pipeline: Step 1: transcript_speakers_extraction (attempt 1/2, model: gpt-5.1)
2025-12-04 17:30:48 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:30:48 [INFO] marketing_project.services.function_pipeline: Step 1 completed in 2.44s
2025-12-04 17:30:48 [WARNING] marketing_project.plugins.transcript_preprocessing_approval:  Step 2/3 PARTIAL: Speakers extraction completed but validation failed - speakers=[], count=0, validation_issues=2, confidence=0.10
2025-12-04 17:30:48 [WARNING] marketing_project.plugins.transcript_preprocessing_approval:   Validation issues: No transcript content was provided (0 characters), so no speakers can be extracted., At least one speaker is required by the specification, but none could be identified from the empty content.
2025-12-04 17:30:48 [INFO] marketing_project.plugins.transcript_preprocessing_approval: Step 3/3: Extracting duration
2025-12-04 17:30:48 [INFO] marketing_project.services.function_pipeline: Step 1: transcript_duration_extraction (attempt 1/2, model: gpt-5.1)
2025-12-04 17:30:50 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 17:30:50 [INFO] marketing_project.services.function_pipeline: Step 1 completed in 2.43s
2025-12-04 17:30:50 [WARNING] marketing_project.plugins.transcript_preprocessing_approval:  Step 3/3 PARTIAL: Duration extraction completed but validation failed - duration=N/As, method=estimated, validation_issues=3, confidence=0.10
2025-12-04 17:30:50 [WARNING] marketing_project.plugins.transcript_preprocessing_approval:   Validation issues: No transcript content was provided (0 characters), so timestamps cannot be scanned., Word-count-based estimation is impossible with an empty transcript., Duration field was not provided in metadata and cannot be inferred.
2025-12-04 17:30:50 [INFO] marketing_project.plugins.transcript_preprocessing_approval: Merging results from 3 LLM calls
2025-12-04 17:30:50 [INFO] marketing_project.plugins.transcript_preprocessing_approval: Transcript preprocessing summary:  Content |  Speakers |  Duration
2025-12-04 17:30:50 [INFO] marketing_project.plugins.transcript_preprocessing_approval: [APPROVAL] Checking approval for cumulative transcript preprocessing result in job 69a4913a-297b-40be-82c5-4d90767277c2
2025-12-04 17:30:50 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Checking if transcript_preprocessing_approval requires approval. Enabled agents: ['article_generation', 'marketing_brief', 'seo_keywords', 'seo_optimization', 'content_formatting', 'content_pipeline', 'transcript_preprocessing_approval']
2025-12-04 17:30:50 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Agent 'transcript_preprocessing_approval' requires approval, creating approval request...
2025-12-04 17:30:50 [INFO] marketing_project.services.approval_manager: Created approval request 21d1b735-e2aa-4948-871d-f0dfec49fe4d for job 69a4913a-297b-40be-82c5-4d90767277c2, agent transcript_preprocessing_approval
2025-12-04 17:30:50 [INFO] marketing_project.processors.approval_helper: [APPROVAL] Created approval request 21d1b735-e2aa-4948-871d-f0dfec49fe4d for transcript_preprocessing_approval in job 69a4913a-297b-40be-82c5-4d90767277c2. Pipeline will stop and wait for approval.
2025-12-04 17:30:50 [INFO] marketing_project.services.approval_manager: Saved pipeline context for job 69a4913a-297b-40be-82c5-4d90767277c2 at step 1 (Step 1: transcript_preprocessing_approval (cumulative))
2025-12-04 17:30:50 [INFO] marketing_project.plugins.transcript_preprocessing_approval: [APPROVAL] Cumulative transcript preprocessing result requires approval. Pipeline stopping. Approval ID: 21d1b735-e2aa-4948-871d-f0dfec49fe4d
2025-12-04 17:30:50 [ERROR] marketing_project.services.function_pipeline: Step 1 (transcript_preprocessing_approval) failed: Approval required for step 1: Step 1: transcript_preprocessing_approval (cumulative) (approval_id: 21d1b735-e2aa-4948-871d-f0dfec49fe4d)
2025-12-04 17:30:50 [INFO] marketing_project.services.function_pipeline: [APPROVAL] Pipeline stopped for approval at step 1 (Step 1: transcript_preprocessing_approval (cumulative)) after 7.66s. Job 69a4913a-297b-40be-82c5-4d90767277c2 marked as WAITING_FOR_APPROVAL
2025-12-04 17:30:50 [INFO] marketing_project.processors: Transcript Processor: Function pipeline completed successfully
2025-12-04 17:30:50 [INFO] marketing_project.processors: Transcript Processor: Processing complete
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:30:50 [ERROR] [marketing_project.services.function_pipeline:execute_pipeline:1032] Step 1 (transcript_preprocessing_approval) failed: Approval required for step 1: Step 1: transcript_preprocessing_approval (cumulative) (approval_id: 21d1b735-e2aa-4948-871d-f0dfec49fe4d)
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
_______________ test_web_scraping_content_source_initialization ________________
tests/services/test_content_sources.py:179: in test_web_scraping_content_source_initialization
    assert source.name == "test_scraper"
           ^^^^^^^^^^^
E   AttributeError: 'WebScrapingContentSource' object has no attribute 'name'
________________ test_web_scraping_content_source_fetch_content ________________
tests/services/test_content_sources.py:210: in test_web_scraping_content_source_fetch_content
    with patch("beautifulsoup4.BeautifulSoup") as mock_bs:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1447: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/pkgutil.py:513: in resolve_name
    mod = importlib.import_module(modname)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap>:1387: in _gcd_import
    ???
<frozen importlib._bootstrap>:1360: in _find_and_load
    ???
<frozen importlib._bootstrap>:1324: in _find_and_load_unlocked
    ???
E   ModuleNotFoundError: No module named 'beautifulsoup4'
____________ TestFunctionPipelineStepExecution.test_resume_pipeline ____________
tests/services/test_function_pipeline.py:526: in test_resume_pipeline
    result = await pipeline.resume_pipeline(
E   TypeError: FunctionPipeline.resume_pipeline() got an unexpected keyword argument 'content_json'
__________ TestFunctionPipelineStepExecution.test_execute_single_step __________
tests/services/test_function_pipeline.py:554: in test_execute_single_step
    result = await pipeline.execute_single_step(
E   TypeError: FunctionPipeline.execute_single_step() missing 1 required positional argument: 'content_json'
___________________________ test_scan_from_base_url ____________________________
tests/services/test_internal_docs_scanner.py:58: in test_scan_from_base_url
    mock_session.get.return_value.__aexit__ = AsyncMock(return_value=None)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'coroutine' object has no attribute '__aexit__'
___________________________ test_scan_from_url_list ____________________________
tests/services/test_internal_docs_scanner.py:89: in test_scan_from_url_list
    mock_session.get.return_value.__aexit__ = AsyncMock(return_value=None)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'coroutine' object has no attribute '__aexit__'
__________________________ test_extract_document_info __________________________
tests/services/test_internal_docs_scanner.py:131: in test_extract_document_info
    result = scanner._extract_document_info(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'InternalDocsScanner' object has no attribute '_extract_document_info'
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:51 [INFO] marketing_project.services.internal_docs_scanner: Internal docs scanner initialized
______________________________ test_extract_links ______________________________
tests/services/test_internal_docs_scanner.py:152: in test_extract_links
    links = scanner._extract_links(mock_soup, base_url, follow_external=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: InternalDocsScanner._extract_links() got an unexpected keyword argument 'follow_external'
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:51 [INFO] marketing_project.services.internal_docs_scanner: Internal docs scanner initialized
___________________ test_get_internal_docs_scanner_singleton ___________________
tests/services/test_internal_docs_scanner.py:183: in test_get_internal_docs_scanner_singleton
    assert scanner1 is scanner2
E   assert <coroutine object get_internal_docs_scanner at 0x31de7db10> is <coroutine object get_internal_docs_scanner at 0x31de7d6f0>
________ TestCircuitBreaker.test_circuit_breaker_open_blocks_operation _________
tests/services/test_redis_manager.py:159: in test_circuit_breaker_open_blocks_operation
    result = redis_manager._check_circuit_breaker()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/redis_manager.py:169: in _check_circuit_breaker
    datetime.now(timezone.utc) - self._circuit_breaker_last_failure
E   TypeError: can't subtract offset-naive and offset-aware datetimes
--------------------------- Captured stdout teardown ---------------------------
2025-12-04 17:30:52 [INFO] marketing_project.services.redis_manager: Redis manager cleaned up
___________ TestCircuitBreaker.test_circuit_breaker_recovery_timeout ___________
tests/services/test_redis_manager.py:178: in test_circuit_breaker_recovery_timeout
    assert redis_manager._check_circuit_breaker() is True
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/redis_manager.py:169: in _check_circuit_breaker
    datetime.now(timezone.utc) - self._circuit_breaker_last_failure
E   TypeError: can't subtract offset-naive and offset-aware datetimes
--------------------------- Captured stdout teardown ---------------------------
2025-12-04 17:30:52 [INFO] marketing_project.services.redis_manager: Redis manager cleaned up
_________ TestRetryLogic.test_execute_circuit_breaker_blocks_when_open _________
tests/services/test_redis_manager.py:249: in test_execute_circuit_breaker_blocks_when_open
    await redis_manager.execute(operation)
src/marketing_project/services/redis_manager.py:334: in execute
    result = await self._execute_with_retry(operation, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/redis_manager.py:227: in _execute_with_retry
    if not self._check_circuit_breaker():
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/redis_manager.py:169: in _check_circuit_breaker
    datetime.now(timezone.utc) - self._circuit_breaker_last_failure
E   TypeError: can't subtract offset-naive and offset-aware datetimes
--------------------------- Captured stdout teardown ---------------------------
2025-12-04 17:30:56 [INFO] marketing_project.services.redis_manager: Redis manager cleaned up
__________ TestPlatformCharacterLimits.test_linkedin_character_limit ___________
tests/services/test_social_media_pipeline_platforms.py:30: in test_linkedin_character_limit
    assert warning is not None
E   assert None is not None
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:56 [WARNING] marketing_project.services.social_media_pipeline: Platform config file not found: /Users/ibrahim/Documents/Github/marketing_tool/src/config/platform_config.yml. Using defaults.
_________ TestPlatformCharacterLimits.test_hackernews_character_limit __________
tests/services/test_social_media_pipeline_platforms.py:54: in test_hackernews_character_limit
    assert warning is not None
E   assert None is not None
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:56 [WARNING] marketing_project.services.social_media_pipeline: Platform config file not found: /Users/ibrahim/Documents/Github/marketing_tool/src/config/platform_config.yml. Using defaults.
______ TestPlatformCharacterLimits.test_email_character_limit_newsletter _______
tests/services/test_social_media_pipeline_platforms.py:79: in test_email_character_limit_newsletter
    assert is_valid is False
E   assert True is False
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:56 [WARNING] marketing_project.services.social_media_pipeline: Platform config file not found: /Users/ibrahim/Documents/Github/marketing_tool/src/config/platform_config.yml. Using defaults.
______ TestPlatformCharacterLimits.test_email_character_limit_promotional ______
tests/services/test_social_media_pipeline_platforms.py:99: in test_email_character_limit_promotional
    assert is_valid is False
E   assert True is False
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:56 [WARNING] marketing_project.services.social_media_pipeline: Platform config file not found: /Users/ibrahim/Documents/Github/marketing_tool/src/config/platform_config.yml. Using defaults.
_____________________________ test_get_step_result _____________________________
tests/services/test_step_result_manager.py:134: in test_get_step_result
    retrieved = await step_result_manager.get_step_result("test-job-1", step_filename)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/step_result_manager.py:859: in get_step_result
    raise FileNotFoundError(f"Job {job_id} not found")
E   FileNotFoundError: Job test-job-1 not found
---------------------------- Captured stdout setup -----------------------------
2025-12-04 17:30:56 [INFO] marketing_project.services.step_result_manager: Step Result Manager initialized with local filesystem, base_dir: /var/folders/sz/sm759s091hxcdzn05lstts_c0000gn/T/tmpxom3jxqg
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:56 [ERROR] marketing_project.services.redis_manager: Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1822' coro=<test_get_step_result() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/services/test_step_result_manager.py:125> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:30:56 [ERROR] marketing_project.services.job_manager: Error reading job test-job-1 from Redis (key: job:test-job-1): RuntimeError: Event loop is closed
2025-12-04 17:30:56 [INFO] marketing_project.services.step_result_manager: Saved step result: 01_seo_keywords.json for job test-job-1 (context: 0, root: test-job-1)
----------------------------- Captured stderr call -----------------------------
2025-12-04 17:30:56 [ERROR] [marketing_project.services.redis_manager:_retry_operation:291] Unexpected error in Redis operation 'get_operation' after 0.000s: RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 554, in read_response
    response = await self._parser.read_response(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 211, in read_response
    await self.read_from_socket()
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/_parsers/hiredis.py", line 189, in read_from_socket
    buffer = await self._stream.read(self._read_size)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 713, in read
    await self._wait_for_data('read')
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 545, in _wait_for_data
    await self._waiter
RuntimeError: Task <Task pending name='Task-1822' coro=<test_get_step_result() running at /Users/ibrahim/Documents/Github/marketing_tool/tests/services/test_step_result_manager.py:125> cb=[_run_until_complete_cb() at /opt/anaconda3/lib/python3.12/asyncio/base_events.py:182]> got Future <Future pending> attached to a different loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/redis_manager.py", line 263, in _retry_operation
    result = await operation(redis_client, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/job_manager.py", line 460, in get_operation
    return await redis_client.get(job_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 646, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 620, in _send_command_parse_response
    return await self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/client.py", line 667, in parse_response
    response = await connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 582, in read_response
    await self.disconnect(nowait=True)
  File "/opt/anaconda3/lib/python3.12/site-packages/redis/asyncio/connection.py", line 438, in disconnect
    self._writer.close()  # type: ignore[union-attr]
    ^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/streams.py", line 358, in close
    return self._transport.close()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 1210, in close
    super().close()
  File "/opt/anaconda3/lib/python3.12/asyncio/selector_events.py", line 875, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 795, in call_soon
    self._check_closed()
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-12-04 17:30:56 [ERROR] [marketing_project.services.job_manager:get_job:489] Error reading job test-job-1 from Redis (key: job:test-job-1): RuntimeError: Event loop is closed
__________________________ test_get_all_step_results ___________________________
tests/services/test_step_result_manager.py:161: in test_get_all_step_results
    results = await step_result_manager.get_job_results("test-job-1")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/step_result_manager.py:364: in get_job_results
    raise FileNotFoundError(f"Job {job_id} not found")
E   FileNotFoundError: Job test-job-1 not found
---------------------------- Captured stdout setup -----------------------------
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Step Result Manager initialized with local filesystem, base_dir: /var/folders/sz/sm759s091hxcdzn05lstts_c0000gn/T/tmpt7y26g5c
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Saved step result: 00_step_0.json for job test-job-1 (context: 0, root: test-job-1)
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Saved step result: 01_step_1.json for job test-job-1 (context: 0, root: test-job-1)
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Saved step result: 02_step_2.json for job test-job-1 (context: 0, root: test-job-1)
____________________________ test_save_job_metadata ____________________________
tests/services/test_step_result_manager.py:200: in test_save_job_metadata
    assert saved_metadata == metadata
E   AssertionError: assert {'completed_a...:00:00Z', ...} == {'created_at'...: 'completed'}
E
E     Omitting 2 identical items, use -vv to show
E     Left contains 5 more items:
E     {'completed_at': None,
E      'content_id': 'test-content-1',
E      'content_type': 'blog_post',
E      'job_id': 'test-job-1',
E      'started_at': '2025-12-04T22:30:57.081055'}
E
E     Full diff:
E       {
E     +     'completed_at': None,
E     +     'content_id': 'test-content-1',
E     +     'content_type': 'blog_post',
E           'created_at': '2024-01-01T00:00:00Z',
E     +     'job_id': 'test-job-1',
E     +     'started_at': '2025-12-04T22:30:57.081055',
E           'status': 'completed',
E       }
---------------------------- Captured stdout setup -----------------------------
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Step Result Manager initialized with local filesystem, base_dir: /var/folders/sz/sm759s091hxcdzn05lstts_c0000gn/T/tmpcmmvw4ci
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Saved job metadata for job test-job-1
____________________________ test_get_job_metadata _____________________________
tests/services/test_step_result_manager.py:219: in test_get_job_metadata
    retrieved = await step_result_manager.get_job_results("test-job-1")
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/marketing_project/services/step_result_manager.py:364: in get_job_results
    raise FileNotFoundError(f"Job {job_id} not found")
E   FileNotFoundError: Job test-job-1 not found
---------------------------- Captured stdout setup -----------------------------
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Step Result Manager initialized with local filesystem, base_dir: /var/folders/sz/sm759s091hxcdzn05lstts_c0000gn/T/tmpt3tf3d91
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:57 [INFO] marketing_project.services.step_result_manager: Saved job metadata for job test-job-1
__________________ test_retry_step_article_generation_success __________________
tests/services/test_step_retry_service.py:143: in test_retry_step_article_generation_success
    mock_result = ArticleGenerationResult(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for ArticleGenerationResult
E   call_to_action
E     Field required [type=missing, input_value={'article_title': 'Test A...eaways': ['Takeaway 1']}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
___________________ test_retry_step_seo_optimization_success ___________________
tests/services/test_step_retry_service.py:175: in test_retry_step_seo_optimization_success
    mock_result = SEOOptimizationResult(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for SEOOptimizationResult
E   slug
E     Field required [type=missing, input_value={'optimized_content': 'Op...'url_slug': 'test-slug'}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
E   url_slug
E     Extra inputs are not permitted [type=extra_forbidden, input_value='test-slug', input_type=str]
E       For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
_____________________ test_build_prompt_article_generation _____________________
tests/services/test_step_retry_service.py:433: in test_build_prompt_article_generation
    assert "test keyword" in prompt
E   AssertionError: assert 'test keyword' in 'Generate a complete article from scratch based on the marketing brief:\n\nSupporting Keywords: None\n\n\n\nMarketing Brief:\n- Target Audience: Developers\n- Key Messages: Message 1\n- Content Strategy: Strategy\n- Tone and Voice: Professional and engaging\n- Competitive Angle: Not specified\n- KPIs: Not specified\n- Distribution Channels: Not specified\n\nGenerate a complete article that:\n- Is created from scratch, aligned with the marketing strategy\n- Uses the supporting keywords naturally throughout the content\n\n\n- Speaks directly to the target audience personas\n- Incorporates all key messages strategically\n- Follows the recommended content strategy\n- Matches the specified tone and voice: Professional and engaging\n- Leverages the competitive angle for differentiation\n- Is designed to achieve the specified KPIs\n- Is optimized for the recommended distribution channels\n\nCreate:\n- Compelling article title optimized for clicks and engagement\n- Well-structured, engaging article content (full article, not a summary)\n- Clear outline with section headers\n- Strong opening hook that captures attention\n- Key takeaways that reinforce the main messages\n- Compelling call-to-action aligned with the strategy'
___________________ test_content_sources_async_list_sources ____________________
tests/test_main.py:145: in test_content_sources_async_list_sources
    mock_manager.add_source_from_config.assert_called()
/opt/anaconda3/lib/python3.12/unittest/mock.py:918: in assert_called
    raise AssertionError(msg)
E   AssertionError: Expected 'add_source_from_config' to have been called.
----------------------------- Captured stdout call -----------------------------
2025-12-04 17:30:58 [INFO] marketing_project.main: Configured Content Sources:
2025-12-04 17:30:58 [INFO] marketing_project.main:   - source1: active (file)
2025-12-04 17:30:58 [INFO] marketing_project.main:   - source2: active (api)
___________________ test_content_sources_async_test_sources ____________________
tests/test_main.py:181: in test_content_sources_async_test_sources
    from marketing_project.services.content_source_factory import FetchResult
E   ImportError: cannot import name 'FetchResult' from 'marketing_project.services.content_source_factory' (/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/content_source_factory.py)
____________________________ test_parse_transcript _____________________________
tests/test_parsers.py:61: in test_parse_transcript
    assert "Speaker 1" in result["speakers"]
E   AssertionError: assert 'Speaker 1' in ['Speaker 2']
_______________ test_parse_transcript_simple_format_still_works ________________
tests/test_parsers.py:223: in test_parse_transcript_simple_format_still_works
    assert "Speaker 1" in result["speakers"]
E   AssertionError: assert 'Speaker 1' in ['Speaker 2']
_____________________________ test_custom_openapi ______________________________
tests/test_server.py:35: in test_custom_openapi
    schema = custom_openapi()
             ^^^^^^^^^^^^^^^^
src/marketing_project/server.py:204: in custom_openapi
    openapi_schema = get_openapi(
/opt/anaconda3/lib/python3.12/site-packages/fastapi/openapi/utils.py:514: in get_openapi
    field_mapping, definitions = get_definitions(
/opt/anaconda3/lib/python3.12/site-packages/fastapi/_compat.py:232: in get_definitions
    field_mapping, definitions = schema_generator.generate_definitions(
/opt/anaconda3/lib/python3.12/site-packages/pydantic/json_schema.py:379: in generate_definitions
    self.generate_inner(schema)
/opt/anaconda3/lib/python3.12/site-packages/pydantic/json_schema.py:459: in generate_inner
    if 'ref' in schema:
       ^^^^^^^^^^^^^^^
<frozen _collections_abc>:813: in __contains__
    ???
/opt/anaconda3/lib/python3.12/site-packages/pydantic/_internal/_mock_val_ser.py:41: in __getitem__
    return self._get_built().__getitem__(key)
           ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/site-packages/pydantic/_internal/_mock_val_ser.py:58: in _get_built
    raise PydanticUserError(self._error_message, code=self._code)
E   pydantic.errors.PydanticUserError: `TypeAdapter[typing.Annotated[marketing_project.models.request_models.PipelineRequest, Body(PydanticUndefined)]]` is not fully defined; you should define `typing.Annotated[marketing_project.models.request_models.PipelineRequest, Body(PydanticUndefined)]` and all referenced types, then call `.rebuild()` on the instance.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
____________________________ test_lifespan_startup _____________________________
tests/test_server.py:74: in test_lifespan_startup
    with patch(
/opt/anaconda3/lib/python3.12/unittest/mock.py:1463: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1436: in get_original
    raise AttributeError(
E   AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_scanned_document_db'
______________________ test_lifespan_startup_no_database _______________________
tests/test_server.py:105: in test_lifespan_startup_no_database
    with patch(
/opt/anaconda3/lib/python3.12/unittest/mock.py:1463: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1436: in get_original
    raise AttributeError(
E   AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_scanned_document_db'
_____________________ test_lifespan_startup_database_error _____________________
tests/test_server.py:135: in test_lifespan_startup_database_error
    with patch(
/opt/anaconda3/lib/python3.12/unittest/mock.py:1463: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1436: in get_original
    raise AttributeError(
E   AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_scanned_document_db'
____________________________ test_lifespan_shutdown ____________________________
tests/test_server.py:172: in test_lifespan_shutdown
    with patch(
/opt/anaconda3/lib/python3.12/unittest/mock.py:1463: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1436: in get_original
    raise AttributeError(
E   AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_redis_manager'
____________________ test_lifespan_shutdown_handles_errors _____________________
tests/test_server.py:222: in test_lifespan_shutdown_handles_errors
    with patch(
/opt/anaconda3/lib/python3.12/unittest/mock.py:1463: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.12/unittest/mock.py:1436: in get_original
    raise AttributeError(
E   AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_redis_manager'
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.12.7-final-0 _______________

Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/api/test_approvals.py::test_decide_approval_reject - assert 400 in [200, 404, 500]
 +  where 400 = <Response [400 Bad Request]>.status_code
FAILED tests/api/test_approvals.py::test_get_all_approvals_for_job - assert 404 in [200, 500]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_approvals.py::test_retry_rejected_step - AttributeError: <module 'marketing_project.api.approvals' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/api/approvals.py'> does not have the attribute 'get_retry_service'
FAILED tests/api/test_design_kit.py::test_get_design_kit_templates - assert 404 in [200, 500]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_design_kit.py::test_get_design_kit_assets - assert 404 in [200, 500]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_internal_docs.py::test_get_internal_docs_config_not_found - assert 200 in [404, 500]
 +  where 200 = <Response [200 OK]>.status_code
FAILED tests/api/test_internal_docs.py::test_scan_internal_docs - assert 404 in [200, 500]
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_linkedin_pipeline_execution - AssertionError: assert 'social_media_marketing_brief' in {'seo_keywords': {'confidence_score': 1.0, 'keyword_clusters': None, 'keyword_density': {'keyword': 0.0}, 'keyword_density_analysis': [{'current_density': 0.0, 'keyword': 'keyword', 'occurrences': 0, 'optimal_density': 2.0, ...}], ...}}
FAILED tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_hackernews_pipeline_execution - AssertionError: assert None == 'hackernews'
 +  where None = <built-in method get of dict object at 0x31b677f40>('platform')
 +    where <built-in method get of dict object at 0x31b677f40> = {}.get
FAILED tests/integration/test_social_media_pipeline_integration.py::TestEndToEndPipeline::test_email_pipeline_execution_newsletter - AssertionError: assert None == 'email'
 +  where None = <built-in method get of dict object at 0x31b6da1c0>('platform')
 +    where <built-in method get of dict object at 0x31b6da1c0> = {}.get
FAILED tests/integration/test_social_media_pipeline_integration.py::TestContentValidation::test_content_length_validation - assert False
 +  where False = any(<generator object TestContentValidation.test_content_length_validation.<locals>.<genexpr> at 0x31b670660>)
FAILED tests/integration/test_social_media_pipeline_integration.py::TestPlatformSpecificFeatures::test_linkedin_hashtags - AssertionError: assert ('hashtags' in {} or None == 'linkedin')
 +  where None = <built-in method get of dict object at 0x31d6af940>('platform')
 +    where <built-in method get of dict object at 0x31d6af940> = {}.get
FAILED tests/integration/test_social_media_pipeline_integration.py::TestPlatformSpecificFeatures::test_email_subject_line - AssertionError: assert 'subject_line' in {}
FAILED tests/middleware/test_trusted_host.py::test_trusted_host_middleware_no_allowed_hosts - assert 400 == 200
 +  where 400 = <Response [400 Bad Request]>.status_code
FAILED tests/middleware/test_trusted_host.py::test_trusted_host_middleware_missing_host_header - assert 200 == 400
 +  where 200 = <Response [200 OK]>.status_code
FAILED tests/plugins/test_article_generation_plugin.py::TestArticleGenerationPlugin::test_step_number - assert 4 == 3
 +  where 4 = <marketing_project.plugins.article_generation.tasks.ArticleGenerationPlugin object at 0x31d6e3620>.step_number
FAILED tests/plugins/test_content_analysis.py::TestAnalyzeContentType::test_analyze_generic_content - AssertionError: assert 'blog_agent' == 'general_agent'

  - general_agent
  + blog_agent
FAILED tests/plugins/test_content_analysis.py::TestAnalyzeContentForPipeline::test_analyze_valid_content - assert False is True
FAILED tests/plugins/test_content_analysis.py::TestIntegration::test_full_content_analysis_workflow - assert False is True
FAILED tests/plugins/test_content_formatting_plugin.py::TestContentFormattingPlugin::test_step_number - assert 8 == 6
 +  where 8 = <marketing_project.plugins.content_formatting.tasks.ContentFormattingPlugin object at 0x31b606d80>.step_number
FAILED tests/plugins/test_marketing_brief_plugin.py::TestMarketingBriefPlugin::test_step_number - assert 3 == 2
 +  where 3 = <marketing_project.plugins.marketing_brief.tasks.MarketingBriefPlugin object at 0x319f82810>.step_number
FAILED tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_step_number - assert 2 == 1
 +  where 2 = <marketing_project.plugins.seo_keywords.tasks.SEOKeywordsPlugin object at 0x31d6e7830>.step_number
FAILED tests/plugins/test_seo_keywords_plugin.py::TestSEOKeywordsPlugin::test_execute - AssertionError: Expected '_call_function' to have been called once. Called 0 times.
FAILED tests/plugins/test_seo_optimization_plugin.py::TestSEOOptimizationPlugin::test_step_number - assert 5 == 4
 +  where 5 = <marketing_project.plugins.seo_optimization.tasks.SEOOptimizationPlugin object at 0x31d69c440>.step_number
FAILED tests/plugins/test_suggested_links_plugin.py::TestSuggestedLinksPlugin::test_step_number - assert 6 == 5
 +  where 6 = <marketing_project.plugins.suggested_links.tasks.SuggestedLinksPlugin object at 0x31d69f3e0>.step_number
FAILED tests/processors/test_approval_helper.py::test_check_and_create_approval_request_approval_required - Failed: DID NOT RAISE <class 'marketing_project.processors.approval_helper.ApprovalRequiredException'>
FAILED tests/processors/test_approval_helper.py::test_prepare_approval_data - AssertionError: assert 'input' in ({'content': {'title': 'Test'}}, {'keywords': ['test']})
FAILED tests/processors/test_approval_helper.py::test_prepare_approval_data_with_confidence - TypeError: prepare_approval_data() got an unexpected keyword argument 'confidence_score'
FAILED tests/processors/test_approval_helper.py::test_prepare_approval_data_with_suggestions - TypeError: prepare_approval_data() got an unexpected keyword argument 'suggestions'
FAILED tests/processors/test_blog_processor.py::TestBlogProcessor::test_process_blog_post_invalid_input - AssertionError: assert 'success' == 'error'

  - error
  + success
FAILED tests/processors/test_releasenotes_processor.py::TestReleaseNotesProcessor::test_process_release_notes_invalid_input - AssertionError: assert 'success' == 'error'

  - error
  + success
FAILED tests/processors/test_transcript_processor.py::TestTranscriptProcessor::test_process_transcript_invalid_input - AssertionError: assert 'success' == 'error'

  - error
  + success
FAILED tests/services/test_content_sources.py::test_web_scraping_content_source_initialization - AttributeError: 'WebScrapingContentSource' object has no attribute 'name'
FAILED tests/services/test_content_sources.py::test_web_scraping_content_source_fetch_content - ModuleNotFoundError: No module named 'beautifulsoup4'
FAILED tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_resume_pipeline - TypeError: FunctionPipeline.resume_pipeline() got an unexpected keyword argument 'content_json'
FAILED tests/services/test_function_pipeline.py::TestFunctionPipelineStepExecution::test_execute_single_step - TypeError: FunctionPipeline.execute_single_step() missing 1 required positional argument: 'content_json'
FAILED tests/services/test_internal_docs_scanner.py::test_scan_from_base_url - AttributeError: 'coroutine' object has no attribute '__aexit__'
FAILED tests/services/test_internal_docs_scanner.py::test_scan_from_url_list - AttributeError: 'coroutine' object has no attribute '__aexit__'
FAILED tests/services/test_internal_docs_scanner.py::test_extract_document_info - AttributeError: 'InternalDocsScanner' object has no attribute '_extract_document_info'
FAILED tests/services/test_internal_docs_scanner.py::test_extract_links - TypeError: InternalDocsScanner._extract_links() got an unexpected keyword argument 'follow_external'
FAILED tests/services/test_internal_docs_scanner.py::test_get_internal_docs_scanner_singleton - assert <coroutine object get_internal_docs_scanner at 0x31de7db10> is <coroutine object get_internal_docs_scanner at 0x31de7d6f0>
FAILED tests/services/test_redis_manager.py::TestCircuitBreaker::test_circuit_breaker_open_blocks_operation - TypeError: can't subtract offset-naive and offset-aware datetimes
FAILED tests/services/test_redis_manager.py::TestCircuitBreaker::test_circuit_breaker_recovery_timeout - TypeError: can't subtract offset-naive and offset-aware datetimes
FAILED tests/services/test_redis_manager.py::TestRetryLogic::test_execute_circuit_breaker_blocks_when_open - TypeError: can't subtract offset-naive and offset-aware datetimes
FAILED tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_linkedin_character_limit - assert None is not None
FAILED tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_hackernews_character_limit - assert None is not None
FAILED tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_email_character_limit_newsletter - assert True is False
FAILED tests/services/test_social_media_pipeline_platforms.py::TestPlatformCharacterLimits::test_email_character_limit_promotional - assert True is False
FAILED tests/services/test_step_result_manager.py::test_get_step_result - FileNotFoundError: Job test-job-1 not found
FAILED tests/services/test_step_result_manager.py::test_get_all_step_results - FileNotFoundError: Job test-job-1 not found
FAILED tests/services/test_step_result_manager.py::test_save_job_metadata - AssertionError: assert {'completed_a...:00:00Z', ...} == {'created_at'...: 'completed'}

  Omitting 2 identical items, use -vv to show
  Left contains 5 more items:
  {'completed_at': None,
   'content_id': 'test-content-1',
   'content_type': 'blog_post',
   'job_id': 'test-job-1',
   'started_at': '2025-12-04T22:30:57.081055'}

  Full diff:
    {
  +     'completed_at': None,
  +     'content_id': 'test-content-1',
  +     'content_type': 'blog_post',
        'created_at': '2024-01-01T00:00:00Z',
  +     'job_id': 'test-job-1',
  +     'started_at': '2025-12-04T22:30:57.081055',
        'status': 'completed',
    }
FAILED tests/services/test_step_result_manager.py::test_get_job_metadata - FileNotFoundError: Job test-job-1 not found
FAILED tests/services/test_step_retry_service.py::test_retry_step_article_generation_success - pydantic_core._pydantic_core.ValidationError: 1 validation error for ArticleGenerationResult
call_to_action
  Field required [type=missing, input_value={'article_title': 'Test A...eaways': ['Takeaway 1']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
FAILED tests/services/test_step_retry_service.py::test_retry_step_seo_optimization_success - pydantic_core._pydantic_core.ValidationError: 2 validation errors for SEOOptimizationResult
slug
  Field required [type=missing, input_value={'optimized_content': 'Op...'url_slug': 'test-slug'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
url_slug
  Extra inputs are not permitted [type=extra_forbidden, input_value='test-slug', input_type=str]
    For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
FAILED tests/services/test_step_retry_service.py::test_build_prompt_article_generation - AssertionError: assert 'test keyword' in 'Generate a complete article from scratch based on the marketing brief:\n\nSupporting Keywords: None\n\n\n\nMarketing Brief:\n- Target Audience: Developers\n- Key Messages: Message 1\n- Content Strategy: Strategy\n- Tone and Voice: Professional and engaging\n- Competitive Angle: Not specified\n- KPIs: Not specified\n- Distribution Channels: Not specified\n\nGenerate a complete article that:\n- Is created from scratch, aligned with the marketing strategy\n- Uses the supporting keywords naturally throughout the content\n\n\n- Speaks directly to the target audience personas\n- Incorporates all key messages strategically\n- Follows the recommended content strategy\n- Matches the specified tone and voice: Professional and engaging\n- Leverages the competitive angle for differentiation\n- Is designed to achieve the specified KPIs\n- Is optimized for the recommended distribution channels\n\nCreate:\n- Compelling article title optimized for clicks and engagement\n- Well-structured, engaging article content (full article, not a summary)\n- Clear outline with section headers\n- Strong opening hook that captures attention\n- Key takeaways that reinforce the main messages\n- Compelling call-to-action aligned with the strategy'
FAILED tests/test_main.py::test_content_sources_async_list_sources - AssertionError: Expected 'add_source_from_config' to have been called.
FAILED tests/test_main.py::test_content_sources_async_test_sources - ImportError: cannot import name 'FetchResult' from 'marketing_project.services.content_source_factory' (/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/services/content_source_factory.py)
FAILED tests/test_parsers.py::test_parse_transcript - AssertionError: assert 'Speaker 1' in ['Speaker 2']
FAILED tests/test_parsers.py::test_parse_transcript_simple_format_still_works - AssertionError: assert 'Speaker 1' in ['Speaker 2']
FAILED tests/test_server.py::test_custom_openapi - pydantic.errors.PydanticUserError: `TypeAdapter[typing.Annotated[marketing_project.models.request_models.PipelineRequest, Body(PydanticUndefined)]]` is not fully defined; you should define `typing.Annotated[marketing_project.models.request_models.PipelineRequest, Body(PydanticUndefined)]` and all referenced types, then call `.rebuild()` on the instance.

For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
FAILED tests/test_server.py::test_lifespan_startup - AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_scanned_document_db'
FAILED tests/test_server.py::test_lifespan_startup_no_database - AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_scanned_document_db'
FAILED tests/test_server.py::test_lifespan_startup_database_error - AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_scanned_document_db'
FAILED tests/test_server.py::test_lifespan_shutdown - AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_redis_manager'
FAILED tests/test_server.py::test_lifespan_shutdown_handles_errors - AttributeError: <module 'marketing_project.server' from '/Users/ibrahim/Documents/Github/marketing_tool/src/marketing_project/server.py'> does not have the attribute 'get_redis_manager'
ERROR tests/api/test_core_endpoints.py::TestPipelineEndpoint::test_run_pipeline_success_blog - pydantic.errors.PydanticUserError: `PipelineRequest` is not fully defined; you should define `PipelineConfig`, then call `PipelineRequest.model_rebuild()`.

For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
ERROR tests/api/test_core_endpoints.py::TestPipelineEndpoint::test_run_pipeline_processor_error - pydantic.errors.PydanticUserError: `PipelineRequest` is not fully defined; you should define `PipelineConfig`, then call `PipelineRequest.model_rebuild()`.

For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
ERROR tests/api/test_core_endpoints.py::TestPipelineEndpoint::test_run_pipeline_execution_error - pydantic.errors.PydanticUserError: `PipelineRequest` is not fully defined; you should define `PipelineConfig`, then call `PipelineRequest.model_rebuild()`.

For further information visit https://errors.pydantic.dev/2.12/u/class-not-fully-defined
====== 65 failed, 516 passed, 234 warnings, 3 errors in 241.96s (0:04:01) ======
